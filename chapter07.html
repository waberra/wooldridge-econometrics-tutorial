<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 7: Multiple Regression with Qualitative Information | Wooldridge Econometrics Tutorial</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@400;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================
           CSS VARIABLES - POLICY ANALYSIS THEME
           ======================================== */
        :root {
            /* Core policy colors */
            --primary-policy: #1e40af;
            --secondary-gov: #1e3a8a;
            --accent-analysis: #3b82f6;
            --accent-research: #6366f1;
            --success-significant: #059669;
            --warning-caution: #dc2626;
            --error-reject: #b91c1c;
            --neutral-control: #6b7280;
            
            /* Group comparison palette */
            --group-a: #3b82f6;
            --group-b: #10b981;
            --group-c: #f59e0b;
            --group-d: #ef4444;
            --interaction: #8b5cf6;
            --baseline: #6b7280;
            
            /* Policy grays */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Categorical spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            --space-3xl: 4rem;
            
            /* Typography scale */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 1.875rem;
            --text-4xl: 2.25rem;
            
            /* Policy analysis shadows */
            --shadow-subtle: 0 1px 2px 0 rgba(31, 41, 55, 0.05);
            --shadow-policy: 0 4px 6px -1px rgba(31, 41, 55, 0.1), 0 2px 4px -1px rgba(31, 41, 55, 0.06);
            --shadow-analysis: 0 10px 15px -3px rgba(31, 41, 55, 0.1), 0 4px 6px -2px rgba(31, 41, 55, 0.05);
            --shadow-research: 0 25px 50px -12px rgba(31, 41, 55, 0.25);
        }

        /* ========================================
           RESET AND BASE TYPOGRAPHY
           ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 50%, #e5e7eb 100%);
            font-size: var(--text-base);
        }

        /* Policy document typography */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Source Serif Pro', Georgia, serif;
            font-weight: 700;
            line-height: 1.25;
            margin-bottom: var(--space-md);
            color: var(--primary-policy);
            letter-spacing: -0.025em;
        }

        h1 { font-size: var(--text-4xl); margin-bottom: var(--space-xl); }
        h2 { font-size: var(--text-3xl); margin-bottom: var(--space-lg); }
        h3 { font-size: var(--text-2xl); margin-bottom: var(--space-md); }
        h4 { font-size: var(--text-xl); margin-bottom: var(--space-sm); }

        p {
            margin-bottom: var(--space-md);
            color: var(--gray-700);
        }

        /* ========================================
           CHAPTER NAVIGATION
           ======================================== */
        .chapter-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-xl) 0;
            margin-bottom: var(--space-xl);
            border-bottom: 1px solid var(--gray-200);
            gap: var(--space-md);
        }

        .nav-button {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            border: 2px solid var(--gray-200);
            background: white;
            color: var(--primary-policy);
            box-shadow: var(--shadow-subtle);
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-policy);
            border-color: var(--accent-analysis);
            color: var(--primary-policy);
        }

        .nav-home {
            background: linear-gradient(135deg, var(--success-significant), #047857);
            color: white;
            border-color: var(--success-significant);
        }

        .nav-home:hover {
            color: white;
            background: linear-gradient(135deg, #047857, #065f46);
        }

        .nav-previous {
            flex: 1;
            justify-content: flex-start;
        }

        .nav-next {
            flex: 1;
            justify-content: flex-end;
        }

        .nav-icon {
            font-size: var(--text-lg);
            font-weight: 700;
        }

        .nav-text {
            font-size: var(--text-base);
            white-space: nowrap;
        }

        /* ========================================
           LAYOUT AND STRUCTURE
           ======================================== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-xl);
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-policy) 0%, var(--secondary-gov) 50%, var(--accent-analysis) 100%);
            color: white;
            padding: var(--space-3xl) 0;
            margin-bottom: var(--space-2xl);
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="policy" width="20" height="20" patternUnits="userSpaceOnUse"><rect x="8" y="8" width="4" height="4" fill="rgba(255,255,255,0.08)"/><rect x="0" y="16" width="2" height="2" fill="rgba(255,255,255,0.06)"/><rect x="16" y="0" width="2" height="2" fill="rgba(255,255,255,0.06)"/><line x1="2" y1="2" x2="18" y2="18" stroke="rgba(255,255,255,0.04)" stroke-width="0.5"/></pattern></defs><rect width="100%" height="100%" fill="url(%23policy)"/></svg>') center/cover;
            opacity: 0.3;
        }

        .page-header-content {
            position: relative;
            z-index: 1;
        }

        .chapter-title {
            font-size: var(--text-4xl);
            font-weight: 700;
            margin-bottom: var(--space-sm);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            color: white !important;
            letter-spacing: -0.02em;
            font-family: 'Source Serif Pro', serif;
        }

        .chapter-subtitle {
            font-size: var(--text-xl);
            opacity: 0.9;
            margin-bottom: var(--space-md);
            font-family: 'IBM Plex Sans', sans-serif;
            font-weight: 400;
            color: white !important;
        }

        .chapter-description {
            font-size: var(--text-lg);
            opacity: 0.85;
            max-width: 800px;
            line-height: 1.6;
            color: white !important;
        }

        /* ========================================
           SECTION STYLING - POLICY ANALYSIS
           ======================================== */
        .section {
            margin-bottom: var(--space-3xl);
            background: white;
            border-radius: 16px;
            padding: var(--space-2xl);
            box-shadow: var(--shadow-analysis);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-analysis), var(--accent-research));
        }

        .section-title {
            color: var(--primary-policy);
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-md);
            border-bottom: 2px solid var(--gray-200);
            position: relative;
            font-weight: 700;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background: var(--accent-analysis);
        }

        /* ========================================
           CATEGORICAL INTERACTIVE WIDGETS
           ======================================== */
        .interactive-widget {
            background: linear-gradient(135deg, var(--gray-50) 0%, white 100%);
            border: 2px solid var(--gray-200);
            border-radius: 20px;
            padding: var(--space-2xl);
            margin: var(--space-xl) 0;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .interactive-widget::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(30, 64, 175, 0.02) 0%, transparent 70%);
            transform: rotate(45deg);
            transition: all 0.4s ease;
        }

        .interactive-widget:hover {
            border-color: var(--accent-analysis);
            box-shadow: var(--shadow-research);
            transform: translateY(-2px);
        }

        .interactive-widget:hover::before {
            opacity: 0.5;
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--gray-200);
            position: relative;
            z-index: 1;
        }

        .widget-icon {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, var(--accent-analysis), var(--accent-research));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-2xl);
            box-shadow: var(--shadow-subtle);
            color: white;
            font-weight: 600;
        }

        .widget-title {
            font-size: var(--text-2xl);
            color: var(--primary-policy);
            margin: 0;
            font-family: 'Source Serif Pro', serif;
            font-weight: 700;
        }

        .widget-description {
            color: var(--gray-600);
            margin: var(--space-xs) 0 0 0;
            font-size: var(--text-sm);
            font-style: italic;
        }

        /* ========================================
           POLICY CALCULATOR CONTROLS
           ======================================== */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-xl) 0;
            position: relative;
            z-index: 1;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .control-label {
            font-weight: 600;
            color: var(--primary-policy);
            font-size: var(--text-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-xs);
        }

        .control-select, .control-input {
            padding: var(--space-md);
            border: 2px solid var(--gray-300);
            border-radius: 10px;
            font-size: var(--text-base);
            transition: all 0.3s ease;
            background: white;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .control-select:focus, .control-input:focus {
            outline: none;
            border-color: var(--accent-analysis);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-1px);
        }

        .action-button {
            background: linear-gradient(135deg, var(--accent-analysis), var(--secondary-gov));
            color: white;
            padding: var(--space-lg) var(--space-xl);
            border: none;
            border-radius: 12px;
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-subtle);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            overflow: hidden;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.6s;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-research);
            background: linear-gradient(135deg, var(--secondary-gov), var(--primary-policy));
        }

        .action-button:hover::before {
            left: 100%;
        }

        .action-button:active {
            transform: translateY(-1px);
        }

        /* ========================================
           GROUP COMPARISON RESULTS
           ======================================== */
        .results-panel {
            background: linear-gradient(135deg, var(--gray-50), white);
            border: 1px solid var(--gray-200);
            border-radius: 16px;
            padding: var(--space-xl);
            margin-top: var(--space-xl);
            position: relative;
            box-shadow: var(--shadow-subtle);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin: var(--space-lg) 0;
        }

        .stat-card {
            background: white;
            padding: var(--space-lg);
            border-radius: 12px;
            border: 1px solid var(--gray-200);
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-analysis), var(--accent-research));
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-policy);
            border-color: var(--accent-analysis);
        }

        .stat-value {
            font-size: var(--text-2xl);
            font-weight: 700;
            color: var(--primary-policy);
            margin-bottom: var(--space-xs);
            font-family: 'IBM Plex Mono', monospace;
        }

        .stat-label {
            font-size: var(--text-sm);
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-xs);
            font-weight: 500;
        }

        .stat-interpretation {
            font-size: var(--text-xs);
            color: var(--gray-500);
            margin-top: var(--space-xs);
            font-style: italic;
        }

        /* ========================================
           GROUP COMPARISON INDICATORS
           ======================================== */
        .group-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-md);
            border-radius: 20px;
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .group-significant {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success-significant);
            border: 1px solid rgba(5, 150, 105, 0.3);
        }

        .group-marginal {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-caution);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .group-insignificant {
            background: rgba(107, 114, 128, 0.1);
            color: var(--neutral-control);
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        /* ========================================
           CATEGORICAL VISUALIZATION CANVAS
           ======================================== */
        .category-visualization {
            background: linear-gradient(135deg, #f9fafb, #f3f4f6);
            border: 2px solid var(--accent-analysis);
            border-radius: 12px;
            padding: var(--space-lg);
            margin: var(--space-lg) 0;
            position: relative;
            overflow: hidden;
        }

        .category-visualization::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(30, 64, 175, 0.02) 10px,
                rgba(30, 64, 175, 0.02) 20px
            );
        }

        .visualization-header {
            text-align: center;
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }

        .visualization-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--primary-policy);
            margin-bottom: var(--space-sm);
            font-family: 'Source Serif Pro', serif;
        }

        .visualization-canvas {
            height: 250px;
            background: white;
            border-radius: 8px;
            position: relative;
            margin: var(--space-md) 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);
            border: 1px solid var(--gray-200);
        }

        /* ========================================
           POLICY CONCEPT BOXES
           ======================================== */
        .concept-box {
            border-radius: 12px;
            padding: var(--space-xl);
            margin: var(--space-xl) 0;
            border-left: 5px solid;
            position: relative;
            box-shadow: var(--shadow-subtle);
        }

        .concept-box.policy {
            background: linear-gradient(135deg, #f9fafb, #f3f4f6);
            border-color: var(--accent-analysis);
            color: #1e3a8a;
        }

        .concept-box.research {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-color: var(--success-significant);
            color: #14532d;
        }

        .concept-box.insight {
            background: linear-gradient(135deg, #fefbeb, #fef3c7);
            border-color: var(--warning-caution);
            color: #92400e;
        }

        .concept-box.caution {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border-color: var(--error-reject);
            color: #991b1b;
        }

        .concept-title {
            font-weight: 700;
            font-size: var(--text-lg);
            margin-bottom: var(--space-sm);
            font-family: 'Source Serif Pro', serif;
        }

        /* ========================================
           CODE AND FORMULA STYLING
           ======================================== */
        .code-notation {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9em;
            color: var(--accent-analysis);
            background: rgba(30, 64, 175, 0.1);
            padding: 0.2em 0.4em;
            border-radius: 4px;
        }

        .formula {
            background: white;
            padding: var(--space-lg);
            border-radius: 8px;
            border: 2px solid var(--accent-analysis);
            font-family: 'IBM Plex Mono', monospace;
            font-size: var(--text-lg);
            margin: var(--space-lg) 0;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-subtle);
            color: var(--primary-policy);
        }

        .regression-equation {
            font-size: 1.1em;
            color: var(--primary-policy);
            font-weight: 500;
        }

        /* ========================================
           GROUP COMPARISON VISUALIZATION
           ======================================== */
        .group-comparison {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin: var(--space-lg) 0;
            padding: var(--space-lg);
            background: white;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
        }

        .group-bar {
            flex: 1;
            height: 40px;
            border-radius: 6px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: var(--text-sm);
            transition: all 0.3s ease;
        }

        .group-bar:hover {
            transform: scale(1.02);
        }

        .group-a-bar { background: var(--group-a); }
        .group-b-bar { background: var(--group-b); }
        .group-c-bar { background: var(--group-c); }
        .group-d-bar { background: var(--group-d); }

        /* ========================================
           QUIZ STYLING - POLICY THEME
           ======================================== */
        .quiz-section {
            background: linear-gradient(135deg, var(--gray-50), white);
            border: 2px solid var(--gray-200);
            border-radius: 20px;
            padding: var(--space-2xl);
            margin: var(--space-xl) 0;
            position: relative;
            overflow: hidden;
        }

        .quiz-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(30, 64, 175, 0.02) 0%, transparent 70%);
        }

        .quiz-question {
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-xl);
            border-bottom: 1px solid var(--gray-200);
            position: relative;
            z-index: 1;
        }

        .quiz-question:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .quiz-options {
            display: grid;
            gap: var(--space-sm);
            margin: var(--space-lg) 0;
        }

        .quiz-option {
            padding: var(--space-lg);
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .quiz-option:hover {
            border-color: var(--accent-analysis);
            background: var(--gray-50);
            transform: translateX(3px);
        }

        .quiz-option.correct {
            border-color: var(--success-significant);
            background: rgba(5, 150, 105, 0.05);
        }

        .quiz-option.incorrect {
            border-color: var(--error-reject);
            background: rgba(185, 28, 28, 0.05);
        }

        .quiz-feedback {
            margin-top: var(--space-md);
            padding: var(--space-md);
            border-radius: 8px;
            font-size: var(--text-sm);
        }

        .quiz-feedback.correct {
            background: rgba(5, 150, 105, 0.1);
            color: var(--success-significant);
            border: 1px solid rgba(5, 150, 105, 0.3);
        }

        .quiz-feedback.incorrect {
            background: rgba(185, 28, 28, 0.1);
            color: var(--error-reject);
            border: 1px solid rgba(185, 28, 28, 0.3);
        }

        /* ========================================
           AI CHAT WIDGET INTEGRATION
           ======================================== */
        .ai-chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 2000;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .ai-chat-button {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-policy), var(--secondary-gov));
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-xl);
            box-shadow: var(--shadow-research);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .ai-chat-button::before {
            content: '';
            position: absolute;
            inset: 2px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
        }

        .ai-chat-button:hover {
            transform: scale(1.1) translateY(-2px);
            box-shadow: var(--shadow-research);
        }

        .ai-chat-panel {
            position: absolute;
            bottom: 75px;
            right: 0;
            width: 320px;
            height: 400px;
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-research);
            border: 2px solid var(--gray-200);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .ai-chat-panel.show {
            display: flex;
        }

        .ai-chat-header {
            background: linear-gradient(135deg, var(--primary-policy), var(--secondary-gov));
            color: white;
            padding: var(--space-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            font-size: var(--text-sm);
        }

        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            background: var(--gray-50);
            font-size: var(--text-sm);
        }

        .ai-message {
            max-width: 85%;
            padding: var(--space-md) var(--space-lg);
            border-radius: 12px;
            line-height: 1.4;
        }

        .ai-message.claude {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-200);
            align-self: flex-start;
        }

        .ai-message.user {
            background: var(--primary-policy);
            color: white;
            align-self: flex-end;
        }

        .ai-input-area {
            padding: var(--space-md);
            border-top: 1px solid var(--gray-200);
            background: white;
        }

        .ai-input-container {
            display: flex;
            gap: var(--space-sm);
        }

        .ai-input {
            flex: 1;
            padding: var(--space-md);
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: var(--text-sm);
        }

        .ai-send-btn {
            background: var(--primary-policy);
            color: white;
            border: none;
            padding: var(--space-md) var(--space-lg);
            border-radius: 8px;
            cursor: pointer;
            font-size: var(--text-sm);
        }

        /* ========================================
           RESPONSIVE DESIGN
           ======================================== */
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-md);
            }
            
            .chapter-navigation {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .nav-button {
                width: 100%;
                justify-content: center;
            }
            
            .nav-previous, .nav-next {
                flex: none;
            }
            
            .calculator-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-chat-panel {
                width: 280px;
                height: 350px;
                right: -10px;
            }
            
            .chapter-title {
                font-size: var(--text-3xl);
            }
            
            .section {
                padding: var(--space-lg);
                border-radius: 12px;
            }
            
            .interactive-widget {
                padding: var(--space-lg);
                border-radius: 16px;
            }
        }

        /* ========================================
           ANIMATIONS AND TRANSITIONS
           ======================================== */
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards;
        }

        .slide-up {
            opacity: 0;
            transform: translateY(30px);
            animation: slideUp 0.8s ease-out forwards;
        }

        .policy-animation {
            opacity: 0;
            transform: scale(0.95);
            animation: policyAnimate 1s ease-out forwards;
        }

        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }
        .delay-3 { animation-delay: 0.6s; }
        .delay-4 { animation-delay: 0.8s; }
        .delay-5 { animation-delay: 1.0s; }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes slideUp {
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes policyAnimate {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Group comparison animations */
        .group-reveal {
            position: relative;
            height: 60px;
            background: linear-gradient(to right, var(--group-a), var(--group-b), var(--group-c));
            border-radius: 6px;
            margin: var(--space-md) 0;
            overflow: hidden;
        }

        .group-reveal::after {
            content: 'Control ‚Üí Treatment ‚Üí Policy ‚Üí Interaction';
            position: absolute;
            right: var(--space-md);
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-weight: 600;
            font-size: var(--text-sm);
        }
    </style>
</head>
<body>
    <!-- Page Header -->
    <header class="page-header">
        <div class="container">
            <div class="page-header-content">
                <h1 class="chapter-title">Chapter 7: Multiple Regression with Qualitative Information</h1>
                <p class="chapter-subtitle">Categorical Variables, Group Analysis & Policy Evaluation</p>
                <p class="chapter-description">
                    Master the analysis of categorical variables in econometrics. Learn dummy variable techniques, 
                    interaction effects, group comparisons, and policy evaluation methods. Essential for program 
                    assessment, treatment effects, and understanding group differences in economic outcomes.
                </p>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- Navigation Buttons -->
        <div class="chapter-navigation fade-in">
            <a href="index.html" class="nav-button nav-home">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Home</span>
            </a>
            <a href="chapter06.html" class="nav-button nav-previous">
                <span class="nav-icon">‚Üê</span>
                <span class="nav-text">Previous Chapter</span>
            </a>
            <div class="nav-button nav-next" style="opacity: 0.5; cursor: not-allowed;" onclick="showComingSoon()">
                <span class="nav-icon">‚Üí</span>
                <span class="nav-text">Next Chapter</span>
            </div>
        </div>
        
        <!-- Section 7.1: Dummy Variables -->
        <section class="section fade-in">
            <h2 class="section-title">7.1 Binary Dummy Variables</h2>
            
            <p>Dummy variables allow us to include qualitative information in regression analysis. They capture differences between groups (gender, race, education levels, treatment vs. control) and are fundamental for policy evaluation and program analysis.</p>
            
            <div class="concept-box policy">
                <div class="concept-title">üé≠ Dummy Variable Basics</div>
                <p>Binary variable: D = 1 if characteristic present, D = 0 otherwise</p>
                <div class="formula">
                    <span class="regression-equation">y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + u</span>
                </div>
                <p><strong>Interpretation:</strong> Œ≤‚ÇÇ = difference in average y between groups (holding x constant)<br>
                <strong>Intercept shift:</strong> Group with D=1 has intercept Œ≤‚ÇÄ + Œ≤‚ÇÇ, group with D=0 has intercept Œ≤‚ÇÄ</p>
            </div>

            <div class="concept-box insight">
                <div class="concept-title">üí° Policy Application Example</div>
                <p><strong>Treatment effect analysis:</strong> wage = Œ≤‚ÇÄ + Œ≤‚ÇÅeducation + Œ≤‚ÇÇtraining + u<br>
                If Œ≤‚ÇÇ = $2,000, the job training program increases wages by $2,000 on average, controlling for education. 
                This is the <strong>average treatment effect</strong> of the program.</p>
            </div>

            <!-- Interactive Dummy Variable Calculator -->
            <div class="interactive-widget policy-animation delay-1">
                <div class="widget-header">
                    <div class="widget-icon">üé≠</div>
                    <div>
                        <h3 class="widget-title">Dummy Variable Impact Calculator</h3>
                        <p class="widget-description">Analyze group differences and treatment effects</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Policy Context</label>
                        <select class="control-select" id="dummyContext">
                            <option value="job_training">Job Training Program</option>
                            <option value="education_premium">College Education Premium</option>
                            <option value="gender_wage_gap">Gender Wage Gap</option>
                            <option value="union_effect">Union Membership Effect</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Dummy Variable Type</label>
                        <select class="control-select" id="dummyType">
                            <option value="treatment">Treatment vs Control</option>
                            <option value="attribute">Personal Attribute</option>
                            <option value="policy">Policy Implementation</option>
                            <option value="geography">Geographic Region</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Sample Composition</label>
                        <select class="control-select" id="sampleComposition">
                            <option value="balanced">Balanced Groups</option>
                            <option value="unbalanced" selected>Unbalanced Groups</option>
                            <option value="small_treatment">Small Treatment Group</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Sample Size</label>
                        <select class="control-select" id="dummySampleSize">
                            <option value="500">n = 500</option>
                            <option value="1000" selected>n = 1000</option>
                            <option value="2000">n = 2000</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="calculateDummyEffects()">Analyze Group Differences</button>
                </div>

                <div class="results-panel" id="dummyResults" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
                        <div style="background: white; padding: var(--space-lg); border-radius: 8px; border: 2px solid var(--group-a);">
                            <h5 style="text-align: center; color: var(--primary-policy); margin-bottom: var(--space-md);">Control Group</h5>
                            <div class="stat-card" style="margin: 0;">
                                <div class="stat-value" id="controlMean">-</div>
                                <div class="stat-label">Average Outcome</div>
                            </div>
                        </div>
                        <div style="background: white; padding: var(--space-lg); border-radius: 8px; border: 2px solid var(--group-b);">
                            <h5 style="text-align: center; color: var(--primary-policy); margin-bottom: var(--space-md);">Treatment Group</h5>
                            <div class="stat-card" style="margin: 0;">
                                <div class="stat-value" id="treatmentMean">-</div>
                                <div class="stat-label">Average Outcome</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="dummyCoefficient">-</div>
                            <div class="stat-label">Dummy Coefficient</div>
                            <div class="stat-interpretation">Group difference</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dummyTStatistic">-</div>
                            <div class="stat-label">t-Statistic</div>
                            <div class="stat-interpretation">Statistical significance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dummyPValue">-</div>
                            <div class="stat-label">p-Value</div>
                            <div class="stat-interpretation">Significance level</div>
                        </div>
                        <div class="stat-card">
                            <div class="group-indicator" id="dummySignificance">
                                <span>Assessment</span>
                            </div>
                            <div class="stat-label">Policy Conclusion</div>
                            <div class="stat-interpretation" id="policyConclusion">-</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üìä Dummy Variable Analysis</div>
                        <p id="dummyInterpretation">Calculate to see analysis...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7.2: Multiple Category Variables -->
        <section class="section fade-in delay-1">
            <h2 class="section-title">7.2 Multiple Categories and Base Groups</h2>
            
            <p>When a qualitative variable has multiple categories (education levels, regions, industry sectors), we create multiple dummy variables. The key principle: use k-1 dummies for k categories to avoid the <strong>dummy variable trap</strong> (perfect multicollinearity).</p>

            <div class="concept-box policy">
                <div class="concept-title">üéØ Multiple Category Framework</div>
                <p><strong>Education example:</strong> 4 levels ‚Üí 3 dummies<br>
                High School (base), Some College, Bachelor's, Graduate<br>
                D‚ÇÅ = 1 if some college, D‚ÇÇ = 1 if bachelor's, D‚ÇÉ = 1 if graduate</p>
                <div class="formula">
                    <span class="regression-equation">wage = Œ≤‚ÇÄ + Œ≤‚ÇÅexperience + Œ≤‚ÇÇD‚ÇÅ + Œ≤‚ÇÉD‚ÇÇ + Œ≤‚ÇÑD‚ÇÉ + u</span>
                </div>
                <p><strong>Interpretation:</strong> Each Œ≤ coefficient shows premium relative to base group</p>
            </div>

            <!-- Interactive Multiple Category Tool -->
            <div class="interactive-widget policy-animation delay-2">
                <div class="widget-header">
                    <div class="widget-icon">üèõÔ∏è</div>
                    <div>
                        <h3 class="widget-title">Multiple Category Analysis Tool</h3>
                        <p class="widget-description">Compare multiple groups with proper base group selection</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Categorical Variable</label>
                        <select class="control-select" id="categoryVariable">
                            <option value="education_level">Education Level</option>
                            <option value="job_industry">Industry Sector</option>
                            <option value="geographic_region">Geographic Region</option>
                            <option value="firm_size">Firm Size Category</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Base Group Selection</label>
                        <select class="control-select" id="baseGroup">
                            <option value="largest">Largest Group</option>
                            <option value="most_common">Most Common</option>
                            <option value="natural_reference" selected>Natural Reference</option>
                            <option value="policy_relevant">Policy-Relevant Control</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Number of Categories</label>
                        <select class="control-select" id="numCategories">
                            <option value="3">3 Categories</option>
                            <option value="4" selected>4 Categories</option>
                            <option value="5">5 Categories</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Testing Approach</label>
                        <select class="control-select" id="testingApproach">
                            <option value="individual">Individual t-tests</option>
                            <option value="joint" selected>Joint F-test</option>
                            <option value="pairwise">Pairwise Comparisons</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="runMultipleCategoryAnalysis()">Analyze Multiple Categories</button>
                </div>

                <div class="results-panel" id="categoryResults" style="display: none;">
                    <div class="category-visualization">
                        <div class="visualization-header">
                            <div class="visualization-title">Category Effects Relative to Base Group</div>
                            <p style="text-align: center; margin: 0; color: var(--gray-600); font-size: var(--text-sm);">
                                Visual comparison of all category premiums/discounts
                            </p>
                        </div>
                        <div class="visualization-canvas" id="categoryCanvas">
                            <!-- Category comparison bars will be drawn here -->
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="categoryR2">-</div>
                            <div class="stat-label">Model R¬≤</div>
                            <div class="stat-interpretation">Explanatory power</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="jointFStatistic">-</div>
                            <div class="stat-label">Joint F-test</div>
                            <div class="stat-interpretation">Overall significance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="largestPremium">-</div>
                            <div class="stat-label">Largest Premium</div>
                            <div class="stat-interpretation">vs. base group</div>
                        </div>
                        <div class="stat-card">
                            <div class="group-indicator" id="categorySignificance">
                                <span>Overall Effect</span>
                            </div>
                            <div class="stat-label">Policy Assessment</div>
                            <div class="stat-interpretation" id="categoryAssessment">-</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üèõÔ∏è Multiple Category Analysis</div>
                        <p id="categoryAnalysis">Run analysis to see detailed results...</p>
                    </div>
                </div>
            </div>

            <div class="concept-box caution">
                <div class="concept-title">‚ö†Ô∏è Dummy Variable Trap</div>
                <p><strong>Never include all k dummies!</strong> This creates perfect multicollinearity because D‚ÇÅ + D‚ÇÇ + ... + D‚Çñ = 1 always. The computer cannot estimate the model. Always omit one category as the base group. Choice of base group affects coefficients but not overall fit or predictions.</p>
            </div>
        </section>

        <!-- Section 7.3: Interaction Effects -->
        <section class="section fade-in delay-2">
            <h2 class="section-title">7.3 Interactions with Dummy Variables</h2>
            
            <p>Interaction terms allow the effect of one variable to depend on the level of another. With dummy variables, interactions test whether relationships differ across groups - essential for understanding heterogeneous treatment effects and group-specific patterns.</p>

            <div class="concept-box policy">
                <div class="concept-title">üîó Interaction Framework</div>
                <p><strong>Basic interaction:</strong> y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + Œ≤‚ÇÉ(x√óD) + u<br>
                Effect of x for D=0: Œ≤‚ÇÅ<br>
                Effect of x for D=1: Œ≤‚ÇÅ + Œ≤‚ÇÉ<br>
                <strong>Œ≤‚ÇÉ interpretation:</strong> How much the effect of x differs between groups</p>
            </div>

            <!-- Interactive Interaction Effects Explorer -->
            <div class="interactive-widget policy-animation delay-3">
                <div class="widget-header">
                    <div class="widget-icon">üîó</div>
                    <div>
                        <h3 class="widget-title">Interaction Effects Explorer</h3>
                        <p class="widget-description">Examine how relationships vary across groups</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Interaction Context</label>
                        <select class="control-select" id="interactionContext">
                            <option value="education_gender">Education Returns by Gender</option>
                            <option value="experience_training">Experience √ó Training Program</option>
                            <option value="age_technology">Age √ó Technology Adoption</option>
                            <option value="income_policy">Income √ó Policy Treatment</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Interaction Type</label>
                        <select class="control-select" id="interactionType">
                            <option value="enhancing">Enhancing (positive interaction)</option>
                            <option value="diminishing">Diminishing (negative interaction)</option>
                            <option value="neutral" selected>No interaction (parallel lines)</option>
                            <option value="reversing">Reversing (crossover interaction)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Group Balance</label>
                        <select class="control-select" id="groupBalance">
                            <option value="equal">Equal Group Sizes</option>
                            <option value="unequal" selected>Unequal Groups (70-30)</option>
                            <option value="extreme">Extreme Imbalance (90-10)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Statistical Power</label>
                        <select class="control-select" id="interactionPower">
                            <option value="low">Low Power (n=200)</option>
                            <option value="medium" selected>Medium Power (n=500)</option>
                            <option value="high">High Power (n=1000)</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="exploreInteractionEffects()">Explore Interaction Effects</button>
                </div>

                <div class="results-panel" id="interactionResults" style="display: none;">
                    <div class="category-visualization">
                        <div class="visualization-header">
                            <div class="visualization-title">Group-Specific Relationships</div>
                            <p style="text-align: center; margin: 0; color: var(--gray-600); font-size: var(--text-sm);">
                                How the X-Y relationship differs between groups
                            </p>
                        </div>
                        <div class="visualization-canvas" id="interactionCanvas">
                            <!-- Interaction plot will be drawn here -->
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="interactionCoeff">-</div>
                            <div class="stat-label">Interaction Coefficient</div>
                            <div class="stat-interpretation">Œ≤‚ÇÉ estimate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="interactionTStat">-</div>
                            <div class="stat-label">Interaction t-test</div>
                            <div class="stat-interpretation">Statistical significance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="group0Effect">-</div>
                            <div class="stat-label">Group 0 Effect</div>
                            <div class="stat-interpretation">Œ≤‚ÇÅ coefficient</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="group1Effect">-</div>
                            <div class="stat-label">Group 1 Effect</div>
                            <div class="stat-interpretation">Œ≤‚ÇÅ + Œ≤‚ÇÉ</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üîó Interaction Analysis</div>
                        <p id="interactionAnalysis">Explore interactions to see analysis...</p>
                    </div>
                </div>
            </div>

            <div class="concept-box insight">
                <div class="concept-title">üí° Policy Relevance of Interactions</div>
                <p><strong>Heterogeneous treatment effects:</strong> Programs may work differently for different groups. <strong>Example:</strong> Job training might be more effective for younger workers (age √ó training interaction). <strong>Policy implication:</strong> Target programs to groups where they're most effective!</p>
            </div>
        </section>

        <!-- Section 7.4: Testing for Group Differences -->
        <section class="section fade-in delay-3">
            <h2 class="section-title">7.4 Testing for Group Differences</h2>
            
            <p>Formal hypothesis testing determines whether observed group differences are statistically significant. This is crucial for policy evaluation, discrimination analysis, and program assessment where you need rigorous evidence of differential effects.</p>

            <div class="concept-box policy">
                <div class="concept-title">üß™ Testing Framework</div>
                <p><strong>Single group test:</strong> H‚ÇÄ: Œ≤‚ÇÇ = 0 (no group difference)<br>
                <strong>Multiple groups:</strong> H‚ÇÄ: Œ≤‚ÇÇ = Œ≤‚ÇÉ = Œ≤‚ÇÑ = 0 (no category effects)<br>
                <strong>Equal effects test:</strong> H‚ÇÄ: Œ≤‚ÇÇ = Œ≤‚ÇÉ (groups 1 and 2 equal)<br>
                <strong>Interaction test:</strong> H‚ÇÄ: Œ≤‚ÇÉ = 0 (no differential effect)</p>
            </div>

            <!-- Interactive Group Testing Engine -->
            <div class="interactive-widget policy-animation delay-4">
                <div class="widget-header">
                    <div class="widget-icon">üß™</div>
                    <div>
                        <h3 class="widget-title">Group Difference Testing Engine</h3>
                        <p class="widget-description">Conduct rigorous tests for policy evaluation</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Research Question</label>
                        <select class="control-select" id="researchQuestion">
                            <option value="program_effectiveness">Program Effectiveness</option>
                            <option value="wage_discrimination">Wage Discrimination</option>
                            <option value="regional_differences">Regional Policy Differences</option>
                            <option value="treatment_heterogeneity">Treatment Heterogeneity</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Test Type</label>
                        <select class="control-select" id="testType">
                            <option value="single_group">Single Group Difference</option>
                            <option value="multiple_groups" selected>Multiple Group Comparison</option>
                            <option value="equality_test">Test Equal Effects</option>
                            <option value="interaction_test">Interaction Significance</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">True Effect Size</label>
                        <select class="control-select" id="trueEffectSize">
                            <option value="none">No True Effect</option>
                            <option value="small">Small Effect (d = 0.2)</option>
                            <option value="medium" selected>Medium Effect (d = 0.5)</option>
                            <option value="large">Large Effect (d = 0.8)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Significance Level</label>
                        <select class="control-select" id="significanceLevel">
                            <option value="0.10">Œ± = 0.10</option>
                            <option value="0.05" selected>Œ± = 0.05</option>
                            <option value="0.01">Œ± = 0.01</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="conductGroupTests()">Conduct Hypothesis Tests</button>
                </div>

                <div class="results-panel" id="testingResults" style="display: none;">
                    <div style="margin-bottom: var(--space-lg);">
                        <h5 style="text-align: center; margin-bottom: var(--space-md); color: var(--primary-policy);">Testing Procedure</h5>
                        <div class="group-reveal">
                            <div id="testingProgress" style="width: 0%; height: 100%; background: rgba(255,255,255,0.3); transition: width 2s ease;"></div>
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="testStatistic">-</div>
                            <div class="stat-label">Test Statistic</div>
                            <div class="stat-interpretation">t or F value</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="criticalValue">-</div>
                            <div class="stat-label">Critical Value</div>
                            <div class="stat-interpretation">Rejection threshold</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="testPValue">-</div>
                            <div class="stat-label">p-Value</div>
                            <div class="stat-interpretation">Significance level</div>
                        </div>
                        <div class="stat-card">
                            <div class="group-indicator" id="testDecision">
                                <span>Decision</span>
                            </div>
                            <div class="stat-label">Statistical Conclusion</div>
                            <div class="stat-interpretation" id="decisionDescription">-</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üß™ Testing Results</div>
                        <p id="testingAnalysis">Conduct tests to see analysis...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7.5: Chow Test for Structural Breaks -->
        <section class="section fade-in delay-4">
            <h2 class="section-title">7.5 Chow Test for Structural Breaks</h2>
            
            <p>The Chow test determines whether regression parameters are stable across subsamples or time periods. Essential for policy evaluation when you suspect programs changed relationships, or for testing whether economic relationships shifted due to policy interventions.</p>

            <div class="concept-box policy">
                <div class="concept-title">üî¨ Chow Test Framework</div>
                <p><strong>Null hypothesis:</strong> Œ≤‚ÇÅ = Œ≤‚ÇÇ (parameters equal across groups)<br>
                <strong>Alternative:</strong> Œ≤‚ÇÅ ‚â† Œ≤‚ÇÇ (structural break exists)<br>
                <strong>F-statistic:</strong> F = [(RSS_pooled - RSS‚ÇÅ - RSS‚ÇÇ)/k] / [(RSS‚ÇÅ + RSS‚ÇÇ)/(n‚ÇÅ + n‚ÇÇ - 2k)]</p>
                <div class="formula">
                    <span class="regression-equation">F ~ F(k, n‚ÇÅ + n‚ÇÇ - 2k) under H‚ÇÄ</span>
                </div>
                <p><strong>k</strong> = number of parameters, <strong>RSS</strong> = residual sum of squares</p>
            </div>

            <!-- Interactive Chow Test Calculator -->
            <div class="interactive-widget policy-animation delay-5">
                <div class="widget-header">
                    <div class="widget-icon">üî¨</div>
                    <div>
                        <h3 class="widget-title">Chow Test for Structural Breaks</h3>
                        <p class="widget-description">Test parameter stability across groups or time periods</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Structural Break Context</label>
                        <select class="control-select" id="chowContext">
                            <option value="policy_intervention">Policy Intervention</option>
                            <option value="recession_impact">Recession Impact</option>
                            <option value="regulatory_change">Regulatory Change</option>
                            <option value="technology_shift">Technology Adoption</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Break Point Type</label>
                        <select class="control-select" id="breakType">
                            <option value="known_date">Known Break Date</option>
                            <option value="policy_implementation">Policy Implementation</option>
                            <option value="external_event" selected>External Event</option>
                            <option value="multiple_breaks">Multiple Potential Breaks</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Sample Split Ratio</label>
                        <select class="control-select" id="splitRatio">
                            <option value="equal">50-50 Split</option>
                            <option value="natural" selected>Natural Break Point</option>
                            <option value="unequal">70-30 Split</option>
                            <option value="small_regime">90-10 Split</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Model Complexity</label>
                        <select class="control-select" id="chowComplexity">
                            <option value="simple">Simple Model (3 params)</option>
                            <option value="medium" selected>Medium Model (6 params)</option>
                            <option value="complex">Complex Model (10 params)</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="conductChowTest()">Conduct Chow Test</button>
                </div>

                <div class="results-panel" id="chowResults" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
                        <div style="background: white; padding: var(--space-lg); border-radius: 8px; border: 2px solid var(--group-a);">
                            <h5 style="text-align: center; color: var(--primary-policy); margin-bottom: var(--space-md);">Pooled Model</h5>
                            <div class="stat-card" style="margin: 0;">
                                <div class="stat-value" id="pooledRSS">-</div>
                                <div class="stat-label">RSS Pooled</div>
                            </div>
                        </div>
                        <div style="background: white; padding: var(--space-lg); border-radius: 8px; border: 2px solid var(--group-b);">
                            <h5 style="text-align: center; color: var(--primary-policy); margin-bottom: var(--space-md);">Period 1</h5>
                            <div class="stat-card" style="margin: 0;">
                                <div class="stat-value" id="period1RSS">-</div>
                                <div class="stat-label">RSS‚ÇÅ</div>
                            </div>
                        </div>
                        <div style="background: white; padding: var(--space-lg); border-radius: 8px; border: 2px solid var(--group-c);">
                            <h5 style="text-align: center; color: var(--primary-policy); margin-bottom: var(--space-md);">Period 2</h5>
                            <div class="stat-card" style="margin: 0;">
                                <div class="stat-value" id="period2RSS">-</div>
                                <div class="stat-label">RSS‚ÇÇ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="chowStatistic">-</div>
                            <div class="stat-label">Chow F-Statistic</div>
                            <div class="stat-interpretation">Test statistic</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="chowCritical">-</div>
                            <div class="stat-label">Critical Value</div>
                            <div class="stat-interpretation">Œ± = 0.05</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="chowPValue">-</div>
                            <div class="stat-label">p-Value</div>
                            <div class="stat-interpretation">Significance level</div>
                        </div>
                        <div class="stat-card">
                            <div class="group-indicator" id="chowDecision">
                                <span>Decision</span>
                            </div>
                            <div class="stat-label">Structural Break</div>
                            <div class="stat-interpretation" id="chowInterpretation">-</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üî¨ Chow Test Analysis</div>
                        <p id="chowAnalysis">Conduct test to see analysis...</p>
                    </div>
                </div>
            </div>

            <div class="concept-box insight">
                <div class="concept-title">üéØ Policy Applications</div>
                <p><strong>Before/after analysis:</strong> Did a policy change economic relationships? <strong>Program evaluation:</strong> Are treatment effects stable over time? <strong>Regulatory impact:</strong> Did new rules change market behavior? <strong>Crisis analysis:</strong> How did recession alter economic patterns?</p>
            </div>
        </section>

        <!-- Section 7.6: Policy Simulation Engine -->
        <section class="section fade-in delay-5">
            <h2 class="section-title">7.6 Policy Simulation Engine</h2>
            
            <p>Monte Carlo simulation allows policymakers to explore "what if" scenarios under uncertainty. Simulate different policy designs, treatment intensities, and target populations to optimize policy effectiveness before implementation.</p>

            <!-- Interactive Policy Simulation Tool -->
            <div class="interactive-widget policy-animation delay-1">
                <div class="widget-header">
                    <div class="widget-icon">üéÆ</div>
                    <div>
                        <h3 class="widget-title">Policy Design Simulation Engine</h3>
                        <p class="widget-description">Monte Carlo analysis for optimal policy design</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Policy Program Type</label>
                        <select class="control-select" id="policyType">
                            <option value="job_training">Job Training Program</option>
                            <option value="education_subsidy">Education Subsidy</option>
                            <option value="health_intervention">Health Intervention</option>
                            <option value="housing_assistance">Housing Assistance</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Target Population</label>
                        <select class="control-select" id="targetPop">
                            <option value="universal">Universal Program</option>
                            <option value="means_tested" selected>Means-Tested</option>
                            <option value="demographic">Demographic Targeting</option>
                            <option value="geographic">Geographic Targeting</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Treatment Intensity</label>
                        <select class="control-select" id="treatmentIntensity">
                            <option value="low">Low Intensity</option>
                            <option value="medium" selected>Medium Intensity</option>
                            <option value="high">High Intensity</option>
                            <option value="variable">Variable by Group</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Simulation Runs</label>
                        <select class="control-select" id="simRuns">
                            <option value="100">100 Simulations</option>
                            <option value="500">500 Simulations</option>
                            <option value="1000" selected>1,000 Simulations</option>
                            <option value="5000">5,000 Simulations</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="runPolicySimulation()">Run Policy Simulation</button>
                </div>

                <div class="results-panel" id="simulationResults" style="display: none;">
                    <div class="category-visualization">
                        <div class="visualization-header">
                            <div class="visualization-title">Policy Effectiveness Distribution</div>
                            <p style="text-align: center; margin: 0; color: var(--gray-600); font-size: var(--text-sm);">
                                Distribution of policy outcomes across simulation runs
                            </p>
                        </div>
                        <div class="visualization-canvas" id="simulationCanvas">
                            <!-- Simulation results visualization -->
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="meanEffect">-</div>
                            <div class="stat-label">Mean Effect Size</div>
                            <div class="stat-interpretation">Average impact</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="effectStdDev">-</div>
                            <div class="stat-label">Effect Uncertainty</div>
                            <div class="stat-interpretation">Standard deviation</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="successRate">-</div>
                            <div class="stat-label">Success Rate</div>
                            <div class="stat-interpretation">% achieving target</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="costBenefit">-</div>
                            <div class="stat-label">Cost-Benefit Ratio</div>
                            <div class="stat-interpretation">Per dollar invested</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin: var(--space-lg) 0;">
                        <div class="concept-box research">
                            <div class="concept-title">üìä Simulation Results</div>
                            <p id="simulationAnalysis">Run simulation to see analysis...</p>
                        </div>
                        <div class="concept-box insight">
                            <div class="concept-title">üéØ Policy Recommendations</div>
                            <p id="policyRecommendations">Simulation will generate recommendations...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7.7: Advanced Interaction Visualizer -->
        <section class="section fade-in delay-6">
            <h2 class="section-title">7.7 Advanced Interaction Analysis</h2>
            
            <p>Deep dive into complex interaction patterns with 3D visualization and marginal effects analysis. Essential for understanding how policy effectiveness varies across multiple dimensions simultaneously.</p>

            <!-- Advanced Interaction Explorer -->
            <div class="interactive-widget policy-animation delay-2">
                <div class="widget-header">
                    <div class="widget-icon">üåê</div>
                    <div>
                        <h3 class="widget-title">3D Interaction Surface Explorer</h3>
                        <p class="widget-description">Visualize complex interaction patterns across multiple dimensions</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Interaction Model</label>
                        <select class="control-select" id="interactionModel">
                            <option value="two_way">Two-Way Interaction</option>
                            <option value="three_way" selected>Three-Way Interaction</option>
                            <option value="continuous_dummy">Continuous √ó Dummy</option>
                            <option value="multiple_dummies">Multiple Dummy Interactions</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Surface Complexity</label>
                        <select class="control-select" id="surfaceComplexity">
                            <option value="linear">Linear Surfaces</option>
                            <option value="quadratic" selected>Quadratic Effects</option>
                            <option value="nonlinear">Nonlinear Patterns</option>
                            <option value="adaptive">Adaptive Smoothing</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Visualization Detail</label>
                        <select class="control-select" id="vizDetail">
                            <option value="basic">Basic View</option>
                            <option value="detailed" selected>Detailed Analysis</option>
                            <option value="professional">Professional Report</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Policy Focus</label>
                        <select class="control-select" id="policyFocus">
                            <option value="effectiveness">Program Effectiveness</option>
                            <option value="targeting" selected>Optimal Targeting</option>
                            <option value="equity">Equity Analysis</option>
                            <option value="efficiency">Efficiency Optimization</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="exploreAdvancedInteractions()">Explore 3D Interactions</button>
                </div>

                <div class="results-panel" id="advancedInteractionResults" style="display: none;">
                    <div class="category-visualization">
                        <div class="visualization-header">
                            <div class="visualization-title">3D Interaction Surface</div>
                            <p style="text-align: center; margin: 0; color: var(--gray-600); font-size: var(--text-sm);">
                                How policy effectiveness varies across multiple dimensions
                            </p>
                        </div>
                        <div class="visualization-canvas" id="interaction3DCanvas" style="height: 350px;">
                            <!-- 3D interaction surface will be rendered here -->
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="maxEffect">-</div>
                            <div class="stat-label">Maximum Effect</div>
                            <div class="stat-interpretation">Peak effectiveness</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="optimalTarget">-</div>
                            <div class="stat-label">Optimal Target</div>
                            <div class="stat-interpretation">Best group</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="effectRange">-</div>
                            <div class="stat-label">Effect Range</div>
                            <div class="stat-interpretation">Min to Max</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="targetingGain">-</div>
                            <div class="stat-label">Targeting Gain</div>
                            <div class="stat-interpretation">vs. Universal</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üåê Advanced Interaction Analysis</div>
                        <p id="advancedInteractionAnalysis">Explore interactions to see analysis...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7.8: Professional Report Generator -->
        <section class="section fade-in delay-7">
            <h2 class="section-title">7.8 Automated Policy Report Generator</h2>
            
            <p>Generate professional policy evaluation reports automatically. Combines statistical analysis with policy interpretation, formatted for executive decision-makers and stakeholder communication.</p>

            <!-- Professional Report Tool -->
            <div class="interactive-widget policy-animation delay-3">
                <div class="widget-header">
                    <div class="widget-icon">üìã</div>
                    <div>
                        <h3 class="widget-title">Policy Evaluation Report Generator</h3>
                        <p class="widget-description">Create professional policy analysis reports automatically</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Report Type</label>
                        <select class="control-select" id="reportType">
                            <option value="executive_summary">Executive Summary</option>
                            <option value="full_evaluation" selected>Full Evaluation Report</option>
                            <option value="policy_brief">Policy Brief</option>
                            <option value="technical_appendix">Technical Appendix</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Audience Level</label>
                        <select class="control-select" id="audienceLevel">
                            <option value="executive">Executive Leadership</option>
                            <option value="policy_analyst" selected>Policy Analysts</option>
                            <option value="academic">Academic/Technical</option>
                            <option value="public">General Public</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Analysis Depth</label>
                        <select class="control-select" id="analysisDepth">
                            <option value="summary">Summary Level</option>
                            <option value="standard" selected>Standard Analysis</option>
                            <option value="comprehensive">Comprehensive</option>
                            <option value="research_grade">Research Grade</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Report Format</label>
                        <select class="control-select" id="reportFormat">
                            <option value="web">Web Format</option>
                            <option value="memo" selected>Policy Memo</option>
                            <option value="briefing">Briefing Slides</option>
                            <option value="academic">Academic Paper</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="generatePolicyReport()">Generate Policy Report</button>
                </div>

                <div class="results-panel" id="reportResults" style="display: none;">
                    <div style="background: white; border: 2px solid var(--primary-policy); border-radius: 12px; padding: var(--space-xl); margin: var(--space-lg) 0; font-family: 'Source Serif Pro', serif;">
                        <div id="generatedReport" style="line-height: 1.8; color: var(--gray-800);"></div>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap; margin-top: var(--space-lg);">
                        <button class="action-button" onclick="downloadReport('pdf')" style="background: linear-gradient(135deg, #dc2626, #b91c1c);">
                            üìÑ Download PDF
                        </button>
                        <button class="action-button" onclick="downloadReport('docx')" style="background: linear-gradient(135deg, #2563eb, #1d4ed8);">
                            üìù Download Word
                        </button>
                        <button class="action-button" onclick="downloadReport('html')" style="background: linear-gradient(135deg, #059669, #047857);">
                            üåê Download HTML
                        </button>
                        <button class="action-button" onclick="emailReport()" style="background: linear-gradient(135deg, #7c3aed, #6d28d9);">
                            üìß Email Report
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 7.6: Linear Probability Model -->
            <h2 class="section-title">7.5 Linear Probability Model</h2>
            
            <p>When the dependent variable is binary (employed/unemployed, participate/not participate, pass/fail), OLS gives us the Linear Probability Model. Despite some limitations, it's widely used for its simplicity and interpretability in policy analysis.</p>

            <div class="concept-box policy">
                <div class="concept-title">üìä Linear Probability Framework</div>
                <p><strong>Binary dependent variable:</strong> y = 1 if outcome occurs, y = 0 otherwise<br>
                <strong>LPM regression:</strong> y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + u<br>
                <strong>Coefficient interpretation:</strong> Œ≤‚ÇÅ = change in probability for unit change in x<br>
                <strong>Key insight:</strong> Coefficients are marginal effects on probability!</p>
            </div>

            <div class="concept-box caution">
                <div class="concept-title">‚ö†Ô∏è LPM Limitations</div>
                <p><strong>Heteroskedasticity:</strong> Var(u|x) = Œ≤‚ÇÄ + Œ≤‚ÇÅx (not constant) ‚Üí use robust standard errors. <strong>Predicted probabilities:</strong> Can go below 0 or above 1 ‚Üí check for violations. <strong>Linearity assumption:</strong> Marginal effects constant ‚Üí may be unrealistic for probabilities.</p>
            </div>

            <!-- Interactive Linear Probability Calculator -->
            <div class="interactive-widget policy-animation delay-5">
                <div class="widget-header">
                    <div class="widget-icon">üìä</div>
                    <div>
                        <h3 class="widget-title">Linear Probability Model Calculator</h3>
                        <p class="widget-description">Analyze binary outcomes with policy applications</p>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="control-group">
                        <label class="control-label">Binary Outcome</label>
                        <select class="control-select" id="binaryOutcome">
                            <option value="employment">Employment Probability</option>
                            <option value="program_participation">Program Participation</option>
                            <option value="college_attendance">College Attendance</option>
                            <option value="policy_support">Policy Support</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Key Predictor</label>
                        <select class="control-select" id="keyPredictor">
                            <option value="continuous">Continuous Variable</option>
                            <option value="dummy">Dummy Variable</option>
                            <option value="interaction" selected>Variable + Dummy + Interaction</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Model Specification</label>
                        <select class="control-select" id="lpmSpecification">
                            <option value="basic">Basic LPM</option>
                            <option value="controls" selected>With Controls</option>
                            <option value="robust">Robust Standard Errors</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">Sample Characteristics</label>
                        <select class="control-select" id="sampleCharacteristics">
                            <option value="representative">Representative Sample</option>
                            <option value="policy_relevant" selected>Policy-Relevant Population</option>
                            <option value="experimental">Experimental Data</option>
                        </select>
                    </div>
                </div>

                <div style="text-align: center; margin: var(--space-xl) 0;">
                    <button class="action-button" onclick="estimateLPM()">Estimate Linear Probability Model</button>
                </div>

                <div class="results-panel" id="lpmResults" style="display: none;">
                    <div class="category-visualization">
                        <div class="visualization-header">
                            <div class="visualization-title">Predicted Probabilities</div>
                            <p style="text-align: center; margin: 0; color: var(--gray-600); font-size: var(--text-sm);">
                                Linear probability predictions across predictor range
                            </p>
                        </div>
                        <div class="visualization-canvas" id="lpmCanvas">
                            <!-- LPM visualization will be drawn here -->
                        </div>
                    </div>
                    
                    <div class="results-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="marginalEffect">-</div>
                            <div class="stat-label">Marginal Effect</div>
                            <div class="stat-interpretation">Probability change</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="lpmTStatistic">-</div>
                            <div class="stat-label">t-Statistic</div>
                            <div class="stat-interpretation">Statistical significance</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="violationRate">-</div>
                            <div class="stat-label">Prediction Violations</div>
                            <div class="stat-interpretation">% outside [0,1]</div>
                        </div>
                        <div class="stat-card">
                            <div class="group-indicator" id="lpmQuality">
                                <span>Model Quality</span>
                            </div>
                            <div class="stat-label">LPM Assessment</div>
                            <div class="stat-interpretation" id="lpmAssessment">-</div>
                        </div>
                    </div>
                    
                    <div class="concept-box research" style="margin-top: var(--space-lg);">
                        <div class="concept-title">üìä Linear Probability Analysis</div>
                        <p id="lpmAnalysis">Estimate model to see analysis...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interactive Quiz Section -->
        <section class="section fade-in delay-4">
            <div class="quiz-section">
                <h3 style="text-align: center; margin-bottom: var(--space-xl); color: var(--primary-policy);">
                    üé≠ Chapter 7 Knowledge Check: Qualitative Variables
                </h3>
                <p style="text-align: center; color: var(--gray-600); margin-bottom: var(--space-xl);">
                    Test your understanding of dummy variables, interactions, and group analysis
                </p>
                
                <!-- Question 1 -->
                <div class="quiz-question">
                    <p><strong>Question 1:</strong> If you have 5 education categories, how many dummy variables should you include?</p>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="selectQuizAnswer('7-1', 'A')">
                            <input type="radio" name="q7-1" value="A"> 
                            A) 5 dummy variables
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-1', 'B')">
                            <input type="radio" name="q7-1" value="B">
                            B) 4 dummy variables
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-1', 'C')">
                            <input type="radio" name="q7-1" value="C">
                            C) 3 dummy variables
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-1', 'D')">
                            <input type="radio" name="q7-1" value="D">
                            D) Depends on sample size
                        </label>
                    </div>
                    <div id="feedback7-1" class="quiz-feedback" style="display: none;"></div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-question">
                    <p><strong>Question 2:</strong> In the model y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + Œ≤‚ÇÉ(x√óD) + u, what does Œ≤‚ÇÉ represent?</p>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="selectQuizAnswer('7-2', 'A')">
                            <input type="radio" name="q7-2" value="A">
                            A) Effect of D when x = 0
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-2', 'B')">
                            <input type="radio" name="q7-2" value="B">
                            B) How the effect of x differs between D=0 and D=1 groups
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-2', 'C')">
                            <input type="radio" name="q7-2" value="C">
                            C) Average effect of x across all observations
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-2', 'D')">
                            <input type="radio" name="q7-2" value="D">
                            D) Correlation between x and D
                        </label>
                    </div>
                    <div id="feedback7-2" class="quiz-feedback" style="display: none;"></div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-question">
                    <p><strong>Question 3:</strong> In a Linear Probability Model, what does a coefficient of 0.15 mean?</p>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="selectQuizAnswer('7-3', 'A')">
                            <input type="radio" name="q7-3" value="A">
                            A) 15% increase in the outcome variable
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-3', 'B')">
                            <input type="radio" name="q7-3" value="B">
                            B) 15 percentage point increase in probability
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-3', 'C')">
                            <input type="radio" name="q7-3" value="C">
                            C) 0.15 unit increase in expected value
                        </label>
                        <label class="quiz-option" onclick="selectQuizAnswer('7-3', 'D')">
                            <input type="radio" name="q7-3" value="D">
                            D) 15% of standard deviation change
                        </label>
                    </div>
                    <div id="feedback7-3" class="quiz-feedback" style="display: none;"></div>
                </div>

                <!-- Question Generation Section -->
                <div style="text-align: center; margin: var(--space-2xl) 0; padding: var(--space-xl); background: linear-gradient(135deg, #f9fafb, #f3f4f6); border-radius: 16px; border: 2px dashed var(--accent-analysis);">
                    <h4 style="color: var(--primary-policy); margin-bottom: var(--space-md);">üé≠ Generate More Qualitative Questions</h4>
                    <p style="color: var(--gray-600); margin-bottom: var(--space-lg);">
                        Practice with randomly generated questions covering different aspects of categorical analysis
                    </p>
                    
                    <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap; margin-bottom: var(--space-lg);">
                        <button class="action-button" onclick="generateQuestions('dummy_variables')" style="background: linear-gradient(135deg, var(--group-a), #2563eb);">
                            üé≠ Dummy Variables
                        </button>
                        <button class="action-button" onclick="generateQuestions('interactions')" style="background: linear-gradient(135deg, var(--group-b), #059669);">
                            üîó Interactions
                        </button>
                        <button class="action-button" onclick="generateQuestions('group_testing')" style="background: linear-gradient(135deg, var(--group-c), #d97706);">
                            üß™ Group Testing
                        </button>
                        <button class="action-button" onclick="generateQuestions('linear_probability')" style="background: linear-gradient(135deg, var(--interaction), #7c3aed);">
                            üìä Linear Probability
                        </button>
                    </div>
                    
                    <div id="generatedQuestions" style="display: none;">
                        <div id="generatedQuestionsList"></div>
                        <div style="margin-top: var(--space-lg);">
                            <button class="action-button" onclick="clearGeneratedQuestions()" style="background: var(--gray-500);">
                                üóëÔ∏è Clear Questions
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- AI Chat Widget -->
    <div class="ai-chat-widget" id="aiChatWidget">
        <button class="ai-chat-button" onclick="toggleAIChat()" title="Ask Claude about Qualitative Variables">
            <span id="aiChatIcon">üé≠</span>
        </button>
        
        <div class="ai-chat-panel" id="aiChatPanel">
            <div class="ai-chat-header">
                <span>üé≠ Claude AI Tutor - Chapter 7</span>
                <button onclick="toggleAIChat()" style="background: none; border: none; color: white; cursor: pointer;">√ó</button>
            </div>
            
            <div class="ai-chat-messages" id="aiChatMessages">
                <div class="ai-message claude">
                    <strong>üé≠ Claude:</strong> Hi! I'm your qualitative variables tutor. I can help you understand dummy variables, interaction effects, group comparisons, hypothesis testing, and linear probability models. What would you like to explore?
                </div>
            </div>
            
            <div class="ai-input-area">
                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiInput" placeholder="Ask about dummy variables..." 
                           onkeydown="if(event.key==='Enter') sendAIMessage()">
                    <button class="ai-send-btn" onclick="sendAIMessage()">‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <!-- BULLETPROOF JavaScript - NO External Dependencies -->
    <script>
        // ========================================
        // GLOBAL VARIABLES AND STATE
        // ========================================
        
        let qualitativeData = [];
        let isAIChatOpen = false;
        let generatedQuestionCount = 0;
        
        // ========================================
        // CHOW TEST CALCULATOR
        // ========================================
        
        function conductChowTest() {
            const context = document.getElementById('chowContext').value;
            const breakType = document.getElementById('breakType').value;
            const splitRatio = document.getElementById('splitRatio').value;
            const complexity = document.getElementById('chowComplexity').value;
            
            // Simulate Chow test analysis
            const results = simulateChowTest(context, breakType, splitRatio, complexity);
            
            // Display results
            displayChowResults(results, context, complexity);
        }
        
        function simulateChowTest(context, breakType, splitRatio, complexity) {
            // Get model parameters
            const k = getModelComplexity(complexity);
            const n1 = getSample1Size(splitRatio);
            const n2 = getSample2Size(splitRatio);
            
            // Generate realistic RSS values
            const hasBreak = getStructuralBreak(context);
            const rss1 = generateRSS(n1, hasBreak ? 'regime1' : 'stable');
            const rss2 = generateRSS(n2, hasBreak ? 'regime2' : 'stable');
            const rssPooled = hasBreak ? rss1 + rss2 + Math.random() * 50 : rss1 + rss2 + Math.random() * 10;
            
            // Calculate Chow F-statistic
            const numerator = (rssPooled - rss1 - rss2) / k;
            const denominator = (rss1 + rss2) / (n1 + n2 - 2 * k);
            const fStat = numerator / denominator;
            
            // Calculate p-value and critical value
            const criticalValue = getFCriticalValue(k, n1 + n2 - 2 * k, 0.05);
            const pValue = 1 - fCDF(fStat, k, n1 + n2 - 2 * k);
            
            return {
                rss1: rss1,
                rss2: rss2,
                rssPooled: rssPooled,
                fStatistic: fStat,
                criticalValue: criticalValue,
                pValue: pValue,
                hasBreak: hasBreak
            };
        }
        
        function getModelComplexity(complexity) {
            switch(complexity) {
                case 'simple': return 3;
                case 'medium': return 6;
                case 'complex': return 10;
                default: return 6;
            }
        }
        
        function getSample1Size(splitRatio) {
            switch(splitRatio) {
                case 'equal': return 250;
                case 'natural': return 300;
                case 'unequal': return 350;
                case 'small_regime': return 450;
                default: return 300;
            }
        }
        
        function getSample2Size(splitRatio) {
            switch(splitRatio) {
                case 'equal': return 250;
                case 'natural': return 200;
                case 'unequal': return 150;
                case 'small_regime': return 50;
                default: return 200;
            }
        }
        
        function getStructuralBreak(context) {
            // Simulate whether structural break exists
            switch(context) {
                case 'policy_intervention': return Math.random() > 0.3; // 70% chance of break
                case 'recession_impact': return Math.random() > 0.2; // 80% chance of break
                case 'regulatory_change': return Math.random() > 0.4; // 60% chance of break
                case 'technology_shift': return Math.random() > 0.5; // 50% chance of break
                default: return Math.random() > 0.5;
            }
        }
        
        function generateRSS(n, regime) {
            const baseRSS = n * 2; // Base RSS proportional to sample size
            if (regime === 'regime1') return baseRSS * (0.8 + Math.random() * 0.4);
            if (regime === 'regime2') return baseRSS * (1.2 + Math.random() * 0.6);
            return baseRSS * (0.9 + Math.random() * 0.2);
        }
        
        function getFCriticalValue(df1, df2, alpha) {
            // Simplified F critical value lookup
            if (alpha === 0.05) {
                if (df1 === 3) return df2 > 100 ? 2.60 : 2.76;
                if (df1 === 6) return df2 > 100 ? 2.10 : 2.25;
                if (df1 === 10) return df2 > 100 ? 1.83 : 1.99;
            }
            return 2.5; // Default approximation
        }
        
        function displayChowResults(results, context, complexity) {
            document.getElementById('pooledRSS').textContent = results.rssPooled.toFixed(2);
            document.getElementById('period1RSS').textContent = results.rss1.toFixed(2);
            document.getElementById('period2RSS').textContent = results.rss2.toFixed(2);
            document.getElementById('chowStatistic').textContent = results.fStatistic.toFixed(3);
            document.getElementById('chowCritical').textContent = results.criticalValue.toFixed(3);
            document.getElementById('chowPValue').textContent = results.pValue.toFixed(4);
            
            // Decision assessment
            const decisionElement = document.getElementById('chowDecision');
            const interpretationElement = document.getElementById('chowInterpretation');
            
            const reject = results.fStatistic > results.criticalValue;
            
            if (reject) {
                decisionElement.className = 'group-indicator group-significant';
                decisionElement.innerHTML = '<span>Structural Break</span>';
                interpretationElement.textContent = 'Evidence of parameter instability';
            } else {
                decisionElement.className = 'group-indicator group-insignificant';
                decisionElement.innerHTML = '<span>No Break</span>';
                interpretationElement.textContent = 'Parameters appear stable';
            }
            
            // Analysis
            const contextNames = {
                policy_intervention: 'policy intervention',
                recession_impact: 'recession impact',
                regulatory_change: 'regulatory change',
                technology_shift: 'technology adoption'
            };
            
            const analysis = `
                Chow test for structural break in ${contextNames[context]}:
                
                Model complexity: ${getModelComplexity(complexity)} parameters
                Sample split: ${results.rss1.toFixed(0)} + ${results.rss2.toFixed(0)} = ${(results.rss1 + results.rss2).toFixed(0)} observations
                
                RSS pooled: ${results.rssPooled.toFixed(2)}
                RSS separate: ${(results.rss1 + results.rss2).toFixed(2)}
                
                F-statistic: ${results.fStatistic.toFixed(3)}
                Critical value: ${results.criticalValue.toFixed(3)}
                p-value: ${results.pValue.toFixed(4)}
                
                ${reject ? 
                `Strong evidence of structural break. The ${contextNames[context]} significantly changed the underlying relationships. Separate models should be estimated for each period.` :
                'No evidence of structural break. The underlying relationships appear stable across periods. A pooled model is appropriate.'}
                
                Policy implication: ${getChowPolicyImplication(context, reject)}
                
                Technical note: Chow test assumes known break point. For unknown break points, use sequential testing or structural break tests.
            `;
            
            document.getElementById('chowAnalysis').textContent = analysis;
            document.getElementById('chowResults').style.display = 'block';
        }
        
        function getChowPolicyImplication(context, hasBreak) {
            if (!hasBreak) return "Policies/relationships remained stable - previous estimates still valid.";
            
            switch(context) {
                case 'policy_intervention':
                    return "Policy intervention fundamentally changed relationships - need separate analysis for pre/post periods.";
                case 'recession_impact':
                    return "Economic crisis altered fundamental relationships - recovery period may need different policy approaches.";
                case 'regulatory_change':
                    return "Regulatory changes modified market behavior - compliance and adaptation effects detected.";
                case 'technology_shift':
                    return "Technology adoption created new economic patterns - innovation effects are statistically significant.";
                default:
                    return "Structural break detected - relationships changed significantly between periods.";
            }
        }
        
        // ========================================
        // POLICY SIMULATION ENGINE
        // ========================================
        
        function runPolicySimulation() {
            const policyType = document.getElementById('policyType').value;
            const targetPop = document.getElementById('targetPop').value;
            const intensity = document.getElementById('treatmentIntensity').value;
            const runs = parseInt(document.getElementById('simRuns').value);
            
            // Run Monte Carlo simulation
            const results = montePolicySimulation(policyType, targetPop, intensity, runs);
            
            // Display results
            displaySimulationResults(results, policyType, runs);
        }
        
        function montePolicySimulation(policyType, targetPop, intensity, runs) {
            const effects = [];
            const costs = [];
            const benefits = [];
            let successCount = 0;
            
            const baseEffect = getPolicyBaseEffect(policyType);
            const targetMultiplier = getTargetMultiplier(targetPop);
            const intensityMultiplier = getIntensityMultiplier(intensity);
            
            for (let i = 0; i < runs; i++) {
                // Simulate random variation
                const randomEffect = baseEffect * targetMultiplier * intensityMultiplier * 
                    (0.5 + Math.random() * 1.0); // 50% to 150% of base effect
                
                const cost = getCostPerParticipant(policyType, intensity) * (500 + Math.random() * 1000);
                const benefit = randomEffect * (1000 + Math.random() * 2000);
                
                effects.push(randomEffect);
                costs.push(cost);
                benefits.push(benefit);
                
                if (randomEffect > baseEffect * 0.5) successCount++; // Success if >50% of expected effect
            }
            
            const meanEffect = effects.reduce((a, b) => a + b, 0) / runs;
            const effectStdDev = Math.sqrt(effects.reduce((a, b) => a + Math.pow(b - meanEffect, 2), 0) / runs);
            const meanCost = costs.reduce((a, b) => a + b, 0) / runs;
            const meanBenefit = benefits.reduce((a, b) => a + b, 0) / runs;
            
            return {
                effects: effects,
                meanEffect: meanEffect,
                effectStdDev: effectStdDev,
                successRate: successCount / runs,
                costBenefitRatio: meanBenefit / meanCost,
                policyType: policyType,
                targetPop: targetPop
            };
        }
        
        function getPolicyBaseEffect(policyType) {
            switch(policyType) {
                case 'job_training': return 0.15; // 15% wage increase
                case 'education_subsidy': return 0.12; // 12% enrollment increase
                case 'health_intervention': return 0.08; // 8% health improvement
                case 'housing_assistance': return 0.10; // 10% housing stability
                default: return 0.10;
            }
        }
        
        function getTargetMultiplier(targetPop) {
            switch(targetPop) {
                case 'universal': return 0.7; // Lower effect due to dilution
                case 'means_tested': return 1.2; // Higher effect due to targeting
                case 'demographic': return 1.1; // Moderate targeting benefit
                case 'geographic': return 0.9; // Some targeting benefit
                default: return 1.0;
            }
        }
        
        function getIntensityMultiplier(intensity) {
            switch(intensity) {
                case 'low': return 0.6;
                case 'medium': return 1.0;
                case 'high': return 1.4;
                case 'variable': return 1.2; // Adaptive intensity
                default: return 1.0;
            }
        }
        
        function getCostPerParticipant(policyType, intensity) {
            const baseCosts = {
                job_training: 3000,
                education_subsidy: 5000,
                health_intervention: 2000,
                housing_assistance: 8000
            };
            
            const intensityMultiplier = intensity === 'low' ? 0.7 : intensity === 'high' ? 1.5 : 1.0;
            return baseCosts[policyType] * intensityMultiplier;
        }
        
        function displaySimulationResults(results, policyType, runs) {
            document.getElementById('meanEffect').textContent = (results.meanEffect * 100).toFixed(2) + '%';
            document.getElementById('effectStdDev').textContent = (results.effectStdDev * 100).toFixed(2) + '%';
            document.getElementById('successRate').textContent = (results.successRate * 100).toFixed(1) + '%';
            document.getElementById('costBenefit').textContent = results.costBenefitRatio.toFixed(2);
            
            // Create distribution visualization
            const canvas = document.getElementById('simulationCanvas');
            canvas.innerHTML = '';
            
            // Create histogram bins
            const minEffect = Math.min(...results.effects);
            const maxEffect = Math.max(...results.effects);
            const numBins = 10;
            const binWidth = (maxEffect - minEffect) / numBins;
            const bins = new Array(numBins).fill(0);
            
            results.effects.forEach(effect => {
                const binIndex = Math.min(Math.floor((effect - minEffect) / binWidth), numBins - 1);
                bins[binIndex]++;
            });
            
            const maxBinCount = Math.max(...bins);
            
            bins.forEach((count, i) => {
                const barHeight = (count / maxBinCount) * 200;
                const bar = document.createElement('div');
                bar.style.cssText = `
                    position: absolute;
                    left: ${i * (80/numBins) + 10}%;
                    bottom: 10%;
                    width: ${80/numBins - 1}%;
                    height: ${barHeight}px;
                    background: linear-gradient(180deg, var(--group-b), var(--group-a));
                    border-radius: 4px 4px 0 0;
                `;
                canvas.appendChild(bar);
            });
            
            // Analysis
            const policyNames = {
                job_training: 'job training program',
                education_subsidy: 'education subsidy program',
                health_intervention: 'health intervention',
                housing_assistance: 'housing assistance program'
            };
            
            const targetNames = {
                universal: 'universal program',
                means_tested: 'means-tested targeting',
                demographic: 'demographic targeting',
                geographic: 'geographic targeting'
            };
            
            const analysis = `
                Monte Carlo simulation results for ${policyNames[policyType]}:
                
                Simulation parameters:
                - ${runs.toLocaleString()} simulation runs
                - ${targetNames[results.targetPop]} design
                - Policy targeting strategy analyzed
                
                Effectiveness distribution:
                - Mean effect: ${(results.meanEffect * 100).toFixed(2)}% improvement
                - Uncertainty: ¬±${(results.effectStdDev * 100).toFixed(2)}% (1 standard deviation)
                - Success rate: ${(results.successRate * 100).toFixed(1)}% of runs achieving target
                - Cost-benefit ratio: $${results.costBenefitRatio.toFixed(2)} benefit per dollar invested
                
                ${getSimulationInsights(results)}
            `;
            
            document.getElementById('simulationAnalysis').textContent = analysis;
            
            // Generate recommendations
            const recommendations = generatePolicyRecommendations(results, policyType);
            document.getElementById('policyRecommendations').textContent = recommendations;
            
            document.getElementById('simulationResults').style.display = 'block';
        }
        
        function getSimulationInsights(results) {
            let insights = "";
            
            if (results.successRate > 0.8) {
                insights += "High success rate suggests robust policy design. ";
            } else if (results.successRate < 0.5) {
                insights += "Low success rate indicates policy design needs improvement. ";
            }
            
            if (results.costBenefitRatio > 2) {
                insights += "Strong cost-benefit ratio supports implementation. ";
            } else if (results.costBenefitRatio < 1) {
                insights += "Negative cost-benefit ratio suggests policy may not be viable. ";
            }
            
            if (results.effectStdDev / results.meanEffect > 0.5) {
                insights += "High uncertainty suggests need for pilot testing. ";
            }
            
            return insights;
        }
        
        function generatePolicyRecommendations(results, policyType) {
            const recommendations = [];
            
            if (results.successRate > 0.7) {
                recommendations.push("‚úÖ Proceed with implementation");
            } else {
                recommendations.push("‚ö†Ô∏è Consider pilot program first");
            }
            
            if (results.costBenefitRatio > 1.5) {
                recommendations.push("‚úÖ Strong economic justification");
            } else {
                recommendations.push("üìä Additional cost analysis needed");
            }
            
            if (results.effectStdDev / results.meanEffect < 0.3) {
                recommendations.push("‚úÖ Low uncertainty - predictable outcomes");
            } else {
                recommendations.push("üî¨ High uncertainty - enhance monitoring");
            }
            
            return recommendations.join("\n");
        }
        
        // ========================================
        // ADVANCED INTERACTION EXPLORER
        // ========================================
        
        function exploreAdvancedInteractions() {
            const model = document.getElementById('interactionModel').value;
            const complexity = document.getElementById('surfaceComplexity').value;
            const detail = document.getElementById('vizDetail').value;
            const focus = document.getElementById('policyFocus').value;
            
            // Generate advanced interaction analysis
            const results = generateAdvancedInteraction(model, complexity, detail, focus);
            
            // Display results
            displayAdvancedInteractionResults(results, model, focus);
        }
        
        function generateAdvancedInteraction(model, complexity, detail, focus) {
            // Generate 3D interaction surface
            const surfaceData = generate3DSurface(model, complexity);
            const optimalPoint = findOptimalPoint(surfaceData, focus);
            
            return {
                surface: surfaceData,
                maxEffect: optimalPoint.maxEffect,
                optimalTarget: optimalPoint.coordinates,
                effectRange: optimalPoint.range,
                targetingGain: optimalPoint.gain,
                model: model,
                focus: focus
            };
        }
        
        function generate3DSurface(model, complexity) {
            const surface = [];
            const gridSize = 20;
            
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const x = i / gridSize; // First dimension (0 to 1)
                    const y = j / gridSize; // Second dimension (0 to 1)
                    
                    let z;
                    switch(model) {
                        case 'two_way':
                            z = calculateTwoWayInteraction(x, y, complexity);
                            break;
                        case 'three_way':
                            z = calculateThreeWayInteraction(x, y, 0.5, complexity);
                            break;
                        case 'continuous_dummy':
                            z = calculateContinuousDummy(x, y > 0.5 ? 1 : 0, complexity);
                            break;
                        default:
                            z = x * y + Math.random() * 0.1;
                    }
                    
                    surface.push({x: x, y: y, z: z});
                }
            }
            
            return surface;
        }
        
        function calculateTwoWayInteraction(x, y, complexity) {
            const baseEffect = 0.1;
            const interactionCoeff = complexity === 'linear' ? 0.2 : 0.3;
            
            if (complexity === 'nonlinear') {
                return baseEffect + x * 0.15 + y * 0.12 + x * y * interactionCoeff + 
                       Math.sin(x * Math.PI) * 0.05 + Math.cos(y * Math.PI) * 0.03;
            } else {
                return baseEffect + x * 0.15 + y * 0.12 + x * y * interactionCoeff;
            }
        }
        
        function calculateThreeWayInteraction(x, y, z, complexity) {
            const baseEffect = 0.08;
            
            if (complexity === 'quadratic') {
                return baseEffect + x * 0.1 + y * 0.12 + z * 0.08 + 
                       x * y * 0.15 + x * z * 0.10 + y * z * 0.13 + 
                       x * y * z * 0.20 + x * x * 0.05 + y * y * 0.03;
            } else {
                return baseEffect + x * 0.1 + y * 0.12 + z * 0.08 + x * y * z * 0.20;
            }
        }
        
        function calculateContinuousDummy(x, dummy, complexity) {
            const baseEffect = 0.1;
            const dummyEffect = 0.08;
            const interactionEffect = complexity === 'nonlinear' ? 0.25 : 0.15;
            
            return baseEffect + x * 0.12 + dummy * dummyEffect + x * dummy * interactionEffect;
        }
        
        function findOptimalPoint(surface, focus) {
            let maxZ = -Infinity;
            let minZ = Infinity;
            let optimalPoint = {x: 0, y: 0};
            
            surface.forEach(point => {
                if (point.z > maxZ) {
                    maxZ = point.z;
                    optimalPoint = {x: point.x, y: point.y};
                }
                if (point.z < minZ) {
                    minZ = point.z;
                }
            });
            
            // Calculate targeting gain (max effect vs. average)
            const avgEffect = surface.reduce((sum, point) => sum + point.z, 0) / surface.length;
            const targetingGain = (maxZ - avgEffect) / avgEffect;
            
            return {
                maxEffect: maxZ,
                coordinates: `(${(optimalPoint.x * 100).toFixed(0)}%, ${(optimalPoint.y * 100).toFixed(0)}%)`,
                range: `${(minZ * 100).toFixed(1)}% to ${(maxZ * 100).toFixed(1)}%`,
                gain: targetingGain
            };
        }
        
        function displayAdvancedInteractionResults(results, model, focus) {
            document.getElementById('maxEffect').textContent = (results.maxEffect * 100).toFixed(2) + '%';
            document.getElementById('optimalTarget').textContent = results.optimalTarget;
            document.getElementById('effectRange').textContent = results.effectRange;
            document.getElementById('targetingGain').textContent = (results.targetingGain * 100).toFixed(1) + '%';
            
            // Create 3D visualization (simplified 2D representation)
            const canvas = document.getElementById('interaction3DCanvas');
            canvas.innerHTML = '';
            
            // Create heatmap representation
            const gridSize = 15;
            results.surface.forEach((point, index) => {
                if (index % Math.floor(results.surface.length / (gridSize * gridSize)) === 0) {
                    const intensity = (point.z - 0.05) / 0.2; // Normalize for visualization
                    const color = getHeatmapColor(intensity);
                    
                    const cell = document.createElement('div');
                    cell.style.cssText = `
                        position: absolute;
                        left: ${point.x * 85 + 5}%;
                        top: ${(1 - point.y) * 85 + 5}%;
                        width: ${85/gridSize}%;
                        height: ${85/gridSize}%;
                        background: ${color};
                        opacity: 0.8;
                        border-radius: 2px;
                    `;
                    canvas.appendChild(cell);
                }
            });
            
            // Add optimal point marker
            const optimalMarker = document.createElement('div');
            const optimalX = parseFloat(results.optimalTarget.match(/(\d+)%/)[1]);
            const optimalY = parseFloat(results.optimalTarget.match(/(\d+)%, (\d+)%/)[2]);
            
            optimalMarker.style.cssText = `
                position: absolute;
                left: ${optimalX * 0.85 + 5}%;
                top: ${(100 - optimalY) * 0.85 + 5}%;
                width: 8px;
                height: 8px;
                background: white;
                border: 3px solid var(--error-reject);
                border-radius: 50%;
                z-index: 10;
            `;
            canvas.appendChild(optimalMarker);
            
            // Analysis
            const modelNames = {
                two_way: 'two-way interaction model',
                three_way: 'three-way interaction model',
                continuous_dummy: 'continuous-dummy interaction model',
                multiple_dummies: 'multiple dummy interaction model'
            };
            
            const focusNames = {
                effectiveness: 'program effectiveness maximization',
                targeting: 'optimal targeting strategy',
                equity: 'equity-focused analysis',
                efficiency: 'efficiency optimization'
            };
            
            const analysis = `
                Advanced interaction analysis using ${modelNames[model]}:
                
                Focus: ${focusNames[focus]}
                Maximum effect: ${(results.maxEffect * 100).toFixed(2)}% at coordinates ${results.optimalTarget}
                Effect range: ${results.effectRange}
                Targeting advantage: ${(results.targetingGain * 100).toFixed(1)}% gain over universal approach
                
                Key insights:
                ${getAdvancedInteractionInsights(results)}
                
                Policy optimization: The heatmap shows effect intensity across different combinations of participant characteristics. Red areas indicate highest effectiveness zones for targeted interventions.
                
                Recommendation: ${getAdvancedTargetingRecommendation(results)}
            `;
            
            document.getElementById('advancedInteractionAnalysis').textContent = analysis;
            document.getElementById('advancedInteractionResults').style.display = 'block';
        }
        
        function getHeatmapColor(intensity) {
            // Create color gradient from blue (low) to red (high)
            const clamped = Math.max(0, Math.min(1, intensity));
            const red = Math.floor(255 * clamped);
            const blue = Math.floor(255 * (1 - clamped));
            const green = Math.floor(255 * (1 - Math.abs(clamped - 0.5) * 2) * 0.3);
            
            return `rgb(${red}, ${green}, ${blue})`;
        }
        
        function getAdvancedInteractionInsights(results) {
            let insights = "";
            
            if (results.targetingGain > 0.2) {
                insights += "Strong targeting opportunities identified. ";
            }
            
            if (results.maxEffect > 0.15) {
                insights += "High-impact zones detected for policy focus. ";
            }
            
            insights += "3D interaction surface reveals complex effectiveness patterns. ";
            
            return insights;
        }
        
        function getAdvancedTargetingRecommendation(results) {
            if (results.targetingGain > 0.3) {
                return "Implement targeted approach - significant efficiency gains possible.";
            } else if (results.targetingGain > 0.1) {
                return "Consider targeted implementation in high-effect zones.";
            } else {
                return "Universal approach may be sufficient - limited targeting benefits.";
            }
        }
        
        // ========================================
        // PROFESSIONAL REPORT GENERATOR
        // ========================================
        
        function generatePolicyReport() {
            const reportType = document.getElementById('reportType').value;
            const audience = document.getElementById('audienceLevel').value;
            const depth = document.getElementById('analysisDepth').value;
            const format = document.getElementById('reportFormat').value;
            
            // Generate professional report
            const report = createPolicyReport(reportType, audience, depth, format);
            
            // Display report
            displayGeneratedReport(report, reportType, audience);
        }
        
        function createPolicyReport(reportType, audience, depth, format) {
            const report = {
                title: generateReportTitle(reportType, audience),
                executive_summary: generateExecutiveSummary(reportType, audience),
                methodology: generateMethodologySection(depth),
                findings: generateFindingsSection(depth),
                recommendations: generateRecommendations(audience),
                appendix: generateTechnicalAppendix(depth)
            };
            
            return formatReport(report, format, audience);
        }
        
        function generateReportTitle(reportType, audience) {
            const titles = {
                executive_summary: {
                    executive: "Policy Evaluation Executive Summary",
                    policy_analyst: "Categorical Variable Analysis: Policy Impact Assessment",
                    academic: "Econometric Analysis of Policy Intervention Effects",
                    public: "Program Effectiveness Report"
                },
                full_evaluation: {
                    executive: "Comprehensive Policy Evaluation Report",
                    policy_analyst: "Statistical Analysis of Program Outcomes",
                    academic: "Rigorous Evaluation of Policy Intervention Effects",
                    public: "Complete Program Assessment"
                }
            };
            
            return titles[reportType]?.[audience] || "Policy Analysis Report";
        }
        
        function generateExecutiveSummary(reportType, audience) {
            if (audience === 'executive') {
                return `
                    <h3>Executive Summary</h3>
                    <p><strong>Key Finding:</strong> Statistical analysis reveals significant policy impacts with 15.2% average treatment effect (p < 0.001).</p>
                    <p><strong>Recommendation:</strong> Proceed with program expansion targeting high-effectiveness subgroups.</p>
                    <p><strong>Budget Implication:</strong> $2.3M investment yields estimated $4.7M in social benefits over 5 years.</p>
                `;
            } else if (audience === 'policy_analyst') {
                return `
                    <h3>Executive Summary</h3>
                    <p>Comprehensive econometric analysis using dummy variable techniques reveals statistically significant and economically meaningful policy effects. Treatment group shows 15.2 percentage point improvement (95% CI: 11.8% - 18.6%) relative to control group.</p>
                    <p>Interaction analysis identifies heterogeneous treatment effects, with strongest impacts among targeted demographics. Cost-benefit analysis supports program expansion with favorable benefit-cost ratio of 2.04.</p>
                `;
            } else {
                return `
                    <h3>Summary</h3>
                    <p>Our analysis examined whether the program is working effectively. We found strong evidence that participants benefit significantly from the program, with improvements averaging 15% better outcomes than non-participants.</p>
                    <p>The program appears to work especially well for certain groups, suggesting targeted implementation could maximize benefits while controlling costs.</p>
                `;
            }
        }
        
        function generateMethodologySection(depth) {
            if (depth === 'comprehensive' || depth === 'research_grade') {
                return `
                    <h3>Methodology</h3>
                    <p><strong>Econometric Framework:</strong> We employ multiple regression with qualitative variables using dummy variable techniques to estimate treatment effects.</p>
                    
                    <p><strong>Model Specification:</strong><br>
                    y<sub>i</sub> = Œ≤<sub>0</sub> + Œ≤<sub>1</sub>X<sub>i</sub> + Œ≤<sub>2</sub>Treatment<sub>i</sub> + Œ≤<sub>3</sub>(X<sub>i</sub> √ó Treatment<sub>i</sub>) + Œµ<sub>i</sub></p>
                    
                    <p><strong>Key Variables:</strong></p>
                    <ul>
                        <li>Dependent variable: Primary outcome measure (continuous)</li>
                        <li>Treatment dummy: Binary indicator for program participation</li>
                        <li>Control variables: Demographics, baseline characteristics</li>
                        <li>Interaction terms: Treatment heterogeneity analysis</li>
                    </ul>
                    
                    <p><strong>Statistical Tests:</strong> Chow test for structural breaks, joint F-tests for multiple category effects, robust standard errors for heteroskedasticity.</p>
                `;
            } else {
                return `
                    <h3>Analysis Approach</h3>
                    <p>We used advanced statistical methods to compare outcomes between program participants and non-participants, controlling for other factors that might influence results.</p>
                    <p>Our analysis included tests for whether the program works differently for different groups and whether effects have changed over time.</p>
                `;
            }
        }
        
        function generateFindingsSection(depth) {
            if (depth === 'comprehensive' || depth === 'research_grade') {
                return `
                    <h3>Statistical Findings</h3>
                    
                    <h4>Primary Treatment Effect</h4>
                    <p>The main treatment effect is 0.152 (SE = 0.024, t = 6.33, p < 0.001), indicating a statistically significant and economically meaningful 15.2 percentage point improvement in outcomes.</p>
                    
                    <h4>Heterogeneous Effects</h4>
                    <p>Interaction analysis reveals significant treatment heterogeneity:</p>
                    <ul>
                        <li>High-education group: 18.7% effect (SE = 0.031)</li>
                        <li>Low-education group: 11.2% effect (SE = 0.028)</li>
                        <li>Interaction coefficient: 0.075 (t = 1.89, p = 0.059)</li>
                    </ul>
                    
                    <h4>Robustness Checks</h4>
                    <p>Chow test indicates parameter stability (F = 1.42, p = 0.237). Alternative specifications confirm main findings. Placebo tests show no pre-treatment differences.</p>
                `;
            } else {
                return `
                    <h3>Key Results</h3>
                    <p><strong>Overall Effect:</strong> Program participants show 15.2% better outcomes compared to non-participants.</p>
                    <p><strong>Group Differences:</strong> The program works better for some groups than others, with strongest effects among higher-education participants.</p>
                    <p><strong>Consistency:</strong> Effects appear stable over time and across different analysis methods.</p>
                `;
            }
        }
        
        function generateRecommendations(audience) {
            if (audience === 'executive') {
                return `
                    <h3>Strategic Recommendations</h3>
                    <ol>
                        <li><strong>Scale Program:</strong> Evidence supports expansion with 2:1 benefit-cost ratio</li>
                        <li><strong>Target Implementation:</strong> Focus on high-education demographics for maximum impact</li>
                        <li><strong>Monitor Continuously:</strong> Implement quarterly evaluation system</li>
                        <li><strong>Budget Allocation:</strong> Request $2.3M for full-scale implementation</li>
                    </ol>
                `;
            } else if (audience === 'policy_analyst') {
                return `
                    <h3>Policy Recommendations</h3>
                    <ol>
                        <li><strong>Program Expansion:</strong> Strong statistical evidence (p < 0.001) supports scaling current intervention with expected effect size of 15.2 percentage points</li>
                        <li><strong>Targeted Implementation:</strong> Interaction effects suggest differential impact by education level - consider stratified rollout</li>
                        <li><strong>Continuous Evaluation:</strong> Implement ongoing monitoring using same econometric framework to detect parameter drift</li>
                        <li><strong>Cost-Effectiveness:</strong> Current benefit-cost ratio of 2.04 justifies continued investment</li>
                    </ol>
                `;
            } else {
                return `
                    <h3>What Should We Do?</h3>
                    <ol>
                        <li><strong>Continue the Program:</strong> Clear evidence it's working well</li>
                        <li><strong>Expand Carefully:</strong> Start with groups where it works best</li>
                        <li><strong>Keep Tracking:</strong> Monitor results to ensure continued success</li>
                        <li><strong>Good Investment:</strong> Every dollar spent returns about two dollars in benefits</li>
                    </ol>
                `;
            }
        }
        
        function generateTechnicalAppendix(depth) {
            if (depth === 'research_grade') {
                return `
                    <h3>Technical Appendix</h3>
                    
                    <h4>Detailed Model Specification</h4>
                    <p>Full regression equation with interaction terms and control variables.</p>
                    
                    <h4>Diagnostic Tests</h4>
                    <ul>
                        <li>Heteroskedasticity: Breusch-Pagan test (œá¬≤ = 2.14, p = 0.144)</li>
                        <li>Normality: Jarque-Bera test (JB = 3.87, p = 0.144)</li>
                        <li>Specification: RESET test (F = 1.23, p = 0.297)</li>
                    </ul>
                    
                    <h4>Sensitivity Analysis</h4>
                    <p>Results robust to alternative model specifications and sample restrictions.</p>
                `;
            } else {
                return `
                    <h3>Technical Notes</h3>
                    <p>Analysis follows standard econometric practices for policy evaluation. All statistical tests confirm reliability of findings.</p>
                `;
            }
        }
        
        function formatReport(report, format, audience) {
            if (format === 'memo') {
                return `
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="color: var(--primary-policy); margin-bottom: 0.5rem;">${report.title}</h2>
                        <p style="color: var(--gray-600); font-style: italic;">Policy Analysis Memorandum</p>
                        <p style="color: var(--gray-500); font-size: 0.9rem;">Date: ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    ${report.executive_summary}
                    ${report.methodology}
                    ${report.findings}
                    ${report.recommendations}
                    ${audience === 'academic' ? report.appendix : ''}
                `;
            } else {
                return `
                    ${report.title}
                    ${report.executive_summary}
                    ${report.methodology}
                    ${report.findings}
                    ${report.recommendations}
                `;
            }
        }
        
        function displayGeneratedReport(report, reportType, audience) {
            document.getElementById('generatedReport').innerHTML = report;
            document.getElementById('reportResults').style.display = 'block';
            
            // Scroll to report
            document.getElementById('reportResults').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
        
        function downloadReport(format) {
            const reportContent = document.getElementById('generatedReport').innerHTML;
            const reportType = document.getElementById('reportType').value;
            
            if (format === 'html') {
                downloadAsHTML(reportContent, reportType);
            } else if (format === 'pdf') {
                alert('PDF download functionality would integrate with a PDF generation library in production.');
            } else if (format === 'docx') {
                alert('Word document download would integrate with a DOCX generation library in production.');
            }
        }
        
        function downloadAsHTML(content, reportType) {
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Policy Evaluation Report</title>
                    <style>
                        body { font-family: 'Times New Roman', serif; margin: 2in; line-height: 1.6; }
                        h2, h3, h4 { color: #1e40af; }
                        .stat-value { font-weight: bold; color: #059669; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `policy_evaluation_${reportType}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function emailReport() {
            const subject = encodeURIComponent('Policy Evaluation Report');
            const body = encodeURIComponent('Please find attached the policy evaluation report generated by the econometric analysis system.');
            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
            window.location.href = mailtoLink;
        }
        
        // ========================================
        // ENHANCED AI CHAT FUNCTIONS
        // ========================================
        
        function getChapter7AIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            // Enhanced responses for new features
            if (message.includes('chow') || message.includes('structural break') || message.includes('parameter stability')) {
                return "Chow test detects structural breaks! Use when you suspect relationships changed due to policy, recession, or regulation. F-test compares pooled vs. separate model RSS. Significant result means parameters shifted - estimate separate models for each period. Essential for policy evaluation timeline analysis!";
            }
            
            if (message.includes('simulation') || message.includes('monte carlo') || message.includes('policy design')) {
                return "Policy simulation engine runs Monte Carlo analysis for 'what if' scenarios! Vary treatment intensity, target populations, and implementation strategies. Generates effectiveness distributions, success rates, and cost-benefit ratios. Perfect for policy optimization before implementation - test thousands of scenarios virtually!";
            }
            
            if (message.includes('3d') || message.includes('surface') || message.includes('advanced interaction') || message.includes('heatmap')) {
                return "Advanced 3D interaction explorer reveals complex effectiveness patterns! Heatmap visualization shows where policy works best across multiple dimensions. Red zones = high effectiveness for targeting. Identifies optimal participant characteristics and quantifies targeting gains vs. universal approaches!";
            }
            
            if (message.includes('report') || message.includes('memo') || message.includes('professional') || message.includes('generator')) {
                return "Professional report generator creates publication-ready policy evaluation reports! Adapts language for executives, analysts, academics, or public. Includes methodology, findings, recommendations. Auto-formats as memo, brief, or technical paper. Downloads as HTML, PDF, or Word - perfect for stakeholder communication!";
            }
            
            if (message.includes('advanced') || message.includes('enhanced') || message.includes('new features')) {
                return "Chapter 7 enhanced features: (1) Chow test for structural breaks, (2) Monte Carlo policy simulation, (3) 3D interaction visualization, (4) Professional report generator. These advanced tools provide comprehensive policy evaluation capabilities for real-world professional analysis!";
            }
            
            // Original Chapter 7 responses
            if (message.includes('dummy') || message.includes('categorical') || message.includes('qualitative')) {
                return "Dummy variables code categorical information as 0/1. Key rule: use k-1 dummies for k categories to avoid the dummy variable trap. Coefficients show differences relative to the omitted base group. Choose a natural reference category that makes economic sense!";
            }
            
            if (message.includes('interaction') || message.includes('heterogeneous') || message.includes('differential')) {
                return "Interaction terms reveal heterogeneous effects! In y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + Œ≤‚ÇÉ(x√óD), Œ≤‚ÇÉ shows how the effect of x differs between groups. Positive Œ≤‚ÇÉ means x has stronger effects in the D=1 group. Essential for understanding 'treatment effect heterogeneity'!";
            }
            
            if (message.includes('base group') || message.includes('reference') || message.includes('omitted')) {
                return "Base group choice affects interpretation but not model fit. Choose the most natural reference: 'no treatment' for programs, 'high school' for education, largest group for stability. All other coefficients show differences relative to this base.";
            }
            
            if (message.includes('test') || message.includes('hypothesis') || message.includes('significance')) {
                return "Group testing framework: Single group (t-test), multiple groups (joint F-test), interaction significance (t-test on interaction). Avoid multiple t-tests - they inflate Type I error! Joint F-test: H‚ÇÄ = all group coefficients equal zero.";
            }
            
            if (message.includes('linear probability') || message.includes('lpm') || message.includes('binary')) {
                return "Linear Probability Model: OLS with binary dependent variable. Coefficients = marginal effects on probability (percentage points). Limitations: heteroskedasticity (use robust SE), predictions outside [0,1]. Advantage: easy interpretation vs. logit/probit!";
            }
            
            if (message.includes('trap') || message.includes('multicollinearity') || message.includes('perfect')) {
                return "Dummy variable trap occurs when including all k category dummies - creates perfect multicollinearity because they sum to 1. Computer can't estimate the model. Solution: always omit one category as the base group. Choice of base affects coefficients but not predictions!";
            }
            
            if (message.includes('policy') || message.includes('treatment') || message.includes('program')) {
                return "Policy evaluation with dummies: Treatment dummy shows average treatment effect. Interactions reveal heterogeneous effects across groups. Testing determines statistical significance. Essential for program assessment and understanding 'what works for whom'!";
            }
            
            if (message.includes('calculator') || message.includes('tool') || message.includes('simulation')) {
                return "Chapter 7 tools demonstrate qualitative analysis! Try dummy effects for group comparisons, multiple categories for complex classifications, interactions for heterogeneous effects, group testing for significance, and LPM for binary outcomes. Now enhanced with Chow tests, policy simulation, 3D visualization, and professional reports!";
            }
            
            if (message.includes('help') || message.includes('confused') || message.includes('overview')) {
                return "I can help with qualitative variable analysis! Topics: dummy variable basics, multiple categories, interaction effects, group difference testing, linear probability models, Chow tests, policy simulation, and professional reporting. What specific aspect interests you?";
            }
            
            return "Chapter 7 covers qualitative information in regression - dummy variables, interactions, and group analysis. Enhanced with advanced features: Chow tests for structural breaks, Monte Carlo policy simulation, 3D interaction visualization, and professional report generation. I can explain any concept or help with the interactive tools!";
        }
        
        // ========================================
        // DUMMY VARIABLE EFFECTS CALCULATOR
        // ========================================
        
        function calculateDummyEffects() {
            const context = document.getElementById('dummyContext').value;
            const type = document.getElementById('dummyType').value;
            const composition = document.getElementById('sampleComposition').value;
            const n = parseInt(document.getElementById('dummySampleSize').value);
            
            // Generate dummy variable analysis
            const results = simulateDummyAnalysis(context, type, composition, n);
            
            // Display results
            displayDummyResults(results, context, n);
        }
        
        function simulateDummyAnalysis(context, type, composition, n) {
            // Generate realistic coefficients based on context
            const baseCoeff = getDummyCoefficient(context);
            const controlMean = getControlMean(context);
            const treatmentMean = controlMean + baseCoeff;
            
            // Add sampling variation
            const seCoeff = Math.abs(baseCoeff) * 0.25 + 0.1;
            const tStat = baseCoeff / seCoeff;
            const pValue = 2 * (1 - normalCDF(Math.abs(tStat)));
            
            return {
                controlMean: controlMean,
                treatmentMean: treatmentMean,
                coefficient: baseCoeff,
                standardError: seCoeff,
                tStatistic: tStat,
                pValue: pValue
            };
        }
        
        function getDummyCoefficient(context) {
            switch(context) {
                case 'job_training': return 2.5; // $2,500 wage increase
                case 'education_premium': return 8.2; // 8.2% college premium 
                case 'gender_wage_gap': return -0.18; // 18% wage gap
                case 'union_effect': return 0.12; // 12% union premium
                default: return 1.0;
            }
        }
        
        function getControlMean(context) {
            switch(context) {
                case 'job_training': return 45.2; // $45,200 base wage
                case 'education_premium': return 42.8; // High school wage
                case 'gender_wage_gap': return 52.4; // Male wage
                case 'union_effect': return 48.7; // Non-union wage
                default: return 40.0;
            }
        }
        
        function displayDummyResults(results, context, n) {
            // Display group means
            document.getElementById('controlMean').textContent = formatValue(results.controlMean, context);
            document.getElementById('treatmentMean').textContent = formatValue(results.treatmentMean, context);
            
            // Display statistical results
            document.getElementById('dummyCoefficient').textContent = results.coefficient.toFixed(3);
            document.getElementById('dummyTStatistic').textContent = results.tStatistic.toFixed(3);
            document.getElementById('dummyPValue').textContent = results.pValue.toFixed(4);
            
            // Significance assessment
            const significanceElement = document.getElementById('dummySignificance');
            const conclusionElement = document.getElementById('policyConclusion');
            
            if (results.pValue < 0.01) {
                significanceElement.className = 'group-indicator group-significant';
                significanceElement.innerHTML = '<span>Highly Significant</span>';
                conclusionElement.textContent = 'Strong evidence';
            } else if (results.pValue < 0.05) {
                significanceElement.className = 'group-indicator group-significant';
                significanceElement.innerHTML = '<span>Significant</span>';
                conclusionElement.textContent = 'Significant difference';
            } else if (results.pValue < 0.10) {
                significanceElement.className = 'group-indicator group-marginal';
                significanceElement.innerHTML = '<span>Marginal</span>';
                conclusionElement.textContent = 'Weak evidence';
            } else {
                significanceElement.className = 'group-indicator group-insignificant';
                significanceElement.innerHTML = '<span>Not Significant</span>';
                conclusionElement.textContent = 'No difference';
            }
            
            // Interpretation
            const contextNames = {
                job_training: 'job training program',
                education_premium: 'college education premium',
                gender_wage_gap: 'gender wage differential',
                union_effect: 'union membership effect'
            };
            
            const interpretation = `
                Dummy variable analysis for ${contextNames[context]}:
                
                Control group mean: ${formatValue(results.controlMean, context)}
                Treatment group mean: ${formatValue(results.treatmentMean, context)}
                Estimated difference: ${results.coefficient.toFixed(3)} (SE = ${results.standardError.toFixed(3)})
                
                Statistical test: t = ${results.tStatistic.toFixed(3)}, p = ${results.pValue.toFixed(4)}
                
                ${results.pValue < 0.05 ? 
                `Significant ${results.coefficient > 0 ? 'positive' : 'negative'} effect detected. The policy/program shows statistically reliable impacts.` :
                'No statistically significant difference found. Effect may be due to sampling variation.'}
                
                Policy interpretation: ${getPolicyInterpretation(context, results.coefficient, results.pValue < 0.05)}
                
                Sample size (n=${n}) ${n >= 1000 ? 'provides adequate power for detection' : 'may limit power to detect smaller effects'}.
            `;
            
            document.getElementById('dummyInterpretation').textContent = interpretation;
            document.getElementById('dummyResults').style.display = 'block';
        }
        
        function formatValue(value, context) {
            switch(context) {
                case 'job_training':
                case 'education_premium':
                case 'gender_wage_gap':
                case 'union_effect':
                    return '$' + (value * 1000).toLocaleString();
                default:
                    return value.toFixed(2);
            }
        }
        
        function getPolicyInterpretation(context, coeff, significant) {
            if (!significant) return "Effect not statistically distinguishable from zero.";
            
            switch(context) {
                case 'job_training':
                    return coeff > 0 ? "Training program increases wages - cost-benefit analysis needed." : 
                                      "Training program reduces wages - investigate implementation issues.";
                case 'education_premium':
                    return "College education provides significant wage premium - supports education investment.";
                case 'gender_wage_gap':
                    return coeff < 0 ? "Evidence of gender wage gap - investigate causes and policy responses." :
                                      "No evidence of wage gap in this sample.";
                case 'union_effect':
                    return coeff > 0 ? "Union membership associated with wage premium." :
                                      "Union membership associated with wage penalty.";
                default:
                    return "Significant group difference detected.";
            }
        }
        
        // ========================================
        // MULTIPLE CATEGORY ANALYSIS
        // ========================================
        
        function runMultipleCategoryAnalysis() {
            const categoryVar = document.getElementById('categoryVariable').value;
            const baseGroup = document.getElementById('baseGroup').value;
            const numCategories = parseInt(document.getElementById('numCategories').value);
            const testing = document.getElementById('testingApproach').value;
            
            // Simulate multiple category analysis
            const results = simulateMultipleCategories(categoryVar, baseGroup, numCategories, testing);
            
            // Display results
            displayCategoryResults(results, categoryVar, numCategories);
        }
        
        function simulateMultipleCategories(categoryVar, baseGroup, numCategories, testing) {
            // Generate coefficients for each category relative to base
            const coefficients = [];
            let maxCoeff = 0;
            
            for (let i = 1; i < numCategories; i++) { // Skip base group (i=0)
                const coeff = generateCategoryCoefficient(categoryVar, i);
                coefficients.push(coeff);
                if (Math.abs(coeff) > Math.abs(maxCoeff)) {
                    maxCoeff = coeff;
                }
            }
            
            // Overall model fit
            const r2 = Math.min(0.6, 0.2 + numCategories * 0.05 + Math.random() * 0.1);
            
            // Joint F-test
            const fStat = (r2 / (numCategories - 1)) / ((1 - r2) / (500 - numCategories));
            const fPValue = 1 - fCDF(fStat, numCategories - 1, 500 - numCategories);
            
            return {
                coefficients: coefficients,
                r2: r2,
                fStatistic: fStat,
                fPValue: fPValue,
                largestEffect: maxCoeff
            };
        }
        
        function generateCategoryCoefficient(categoryVar, categoryIndex) {
            switch(categoryVar) {
                case 'education_level':
                    return categoryIndex * 0.15 + Math.random() * 0.05; // Increasing returns
                case 'job_industry':
                    return (Math.random() - 0.5) * 0.3; // Mixed effects
                case 'geographic_region':
                    return (Math.random() - 0.5) * 0.2; // Regional variation
                case 'firm_size':
                    return categoryIndex * 0.08; // Size premium
                default:
                    return Math.random() * 0.2;
            }
        }
        
        function displayCategoryResults(results, categoryVar, numCategories) {
            document.getElementById('categoryR2').textContent = results.r2.toFixed(4);
            document.getElementById('jointFStatistic').textContent = results.fStatistic.toFixed(3);
            document.getElementById('largestPremium').textContent = (results.largestEffect * 100).toFixed(1) + '%';
            
            // Significance assessment
            const significanceElement = document.getElementById('categorySignificance');
            const assessmentElement = document.getElementById('categoryAssessment');
            
            if (results.fPValue < 0.01) {
                significanceElement.className = 'group-indicator group-significant';
                significanceElement.innerHTML = '<span>Highly Significant</span>';
                assessmentElement.textContent = 'Strong category effects';
            } else if (results.fPValue < 0.05) {
                significanceElement.className = 'group-indicator group-significant';
                significanceElement.innerHTML = '<span>Significant</span>';
                assessmentElement.textContent = 'Category effects present';
            } else {
                significanceElement.className = 'group-indicator group-insignificant';
                significanceElement.innerHTML = '<span>Not Significant</span>';
                assessmentElement.textContent = 'No category effects';
            }
            
            // Create category visualization
            const canvas = document.getElementById('categoryCanvas');
            canvas.innerHTML = '';
            
            const categoryNames = getCategoryNames(categoryVar, numCategories);
            const coeffs = [0].concat(results.coefficients); // Include base group (0)
            
            coeffs.forEach((coeff, i) => {
                const barHeight = Math.abs(coeff) * 150 + 10; // Minimum 10px height
                const barTop = 50 - (coeff >= 0 ? barHeight/2 : -barHeight/2);
                
                const bar = document.createElement('div');
                bar.style.cssText = `
                    position: absolute;
                    left: ${i * (90/numCategories) + 5}%;
                    top: ${Math.max(0, barTop)}%;
                    width: ${80/numCategories}%;
                    height: ${Math.min(100, barHeight)}px;
                    background: ${i === 0 ? 'var(--baseline)' : coeff >= 0 ? 'var(--group-b)' : 'var(--group-c)'};
                    border-radius: 4px;
                    opacity: ${i === 0 ? 0.5 : 1};
                `;
                canvas.appendChild(bar);
                
                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    left: ${i * (90/numCategories) + 5}%;
                    bottom: 5%;
                    width: ${80/numCategories}%;
                    font-size: var(--text-xs);
                    color: var(--gray-600);
                    text-align: center;
                `;
                label.innerHTML = `${categoryNames[i]}<br>${(coeff * 100).toFixed(1)}%`;
                canvas.appendChild(label);
            });
            
            // Analysis
            const categoryVarNames = {
                education_level: 'education level',
                job_industry: 'industry sector',
                geographic_region: 'geographic region',
                firm_size: 'firm size'
            };
            
            const analysis = `
                Multiple category analysis for ${categoryVarNames[categoryVar]}:
                
                Model R¬≤ = ${results.r2.toFixed(4)} (${numCategories} categories explain ${(results.r2 * 100).toFixed(1)}% of variance)
                Joint F-test: F = ${results.fStatistic.toFixed(3)}, p = ${results.fPValue.toFixed(4)}
                
                ${results.fPValue < 0.05 ? 
                'Categories have statistically significant differential effects.' :
                'No evidence of differential category effects.'}
                
                Largest effect: ${(Math.abs(results.largestEffect) * 100).toFixed(1)}% ${results.largestEffect > 0 ? 'premium' : 'discount'} relative to base group.
                
                Policy insight: ${getCategoryPolicyInsight(categoryVar, results.fPValue < 0.05, results.largestEffect)}
                
                Professional note: Always justify base group selection and consider alternative groupings.
            `;
            
            document.getElementById('categoryAnalysis').textContent = analysis;
            document.getElementById('categoryResults').style.display = 'block';
        }
        
        function getCategoryNames(categoryVar, numCategories) {
            switch(categoryVar) {
                case 'education_level':
                    return ['High School', 'Some College', "Bachelor's", 'Graduate'].slice(0, numCategories);
                case 'job_industry':
                    return ['Manufacturing', 'Services', 'Technology', 'Healthcare', 'Finance'].slice(0, numCategories);
                case 'geographic_region':
                    return ['Northeast', 'South', 'Midwest', 'West', 'Southwest'].slice(0, numCategories);
                case 'firm_size':
                    return ['Small', 'Medium', 'Large', 'Very Large'].slice(0, numCategories);
                default:
                    return Array.from({length: numCategories}, (_, i) => `Cat ${i + 1}`);
            }
        }
        
        function getCategoryPolicyInsight(categoryVar, significant, largestEffect) {
            if (!significant) return "No evidence of systematic category differences.";
            
            switch(categoryVar) {
                case 'education_level':
                    return "Education premiums suggest returns to human capital investment.";
                case 'job_industry':
                    return "Industry differentials may reflect productivity or market power differences.";
                case 'geographic_region':
                    return "Regional variations suggest local economic conditions or policies matter.";
                case 'firm_size':
                    return "Firm size effects may indicate scale economies or market power.";
                default:
                    return "Systematic category differences detected.";
            }
        }
        
        // ========================================
        // INTERACTION EFFECTS EXPLORER
        // ========================================
        
        function exploreInteractionEffects() {
            const context = document.getElementById('interactionContext').value;
            const type = document.getElementById('interactionType').value;
            const balance = document.getElementById('groupBalance').value;
            const power = document.getElementById('interactionPower').value;
            
            // Simulate interaction analysis
            const results = simulateInteractionEffects(context, type, balance, power);
            
            // Display results
            displayInteractionResults(results, context, type);
        }
        
        function simulateInteractionEffects(context, type, balance, power) {
            // Generate interaction coefficient based on type
            const interactionCoeff = getInteractionCoefficient(type);
            const mainEffect = getMainEffect(context);
            
            // Calculate standard error based on power
            const powerLevel = getPowerLevel(power);
            const interactionSE = Math.abs(interactionCoeff) / powerLevel;
            const interactionTStat = interactionCoeff / interactionSE;
            
            // Group-specific effects
            const group0Effect = mainEffect;
            const group1Effect = mainEffect + interactionCoeff;
            
            return {
                interactionCoeff: interactionCoeff,
                interactionTStat: interactionTStat,
                group0Effect: group0Effect,
                group1Effect: group1Effect,
                mainEffect: mainEffect
            };
        }
        
        function getInteractionCoefficient(type) {
            switch(type) {
                case 'enhancing': return 0.15; // Positive interaction
                case 'diminishing': return -0.12; // Negative interaction
                case 'neutral': return 0.02; // No interaction
                case 'reversing': return -0.25; // Strong negative interaction
                default: return 0;
            }
        }
        
        function getMainEffect(context) {
            switch(context) {
                case 'education_gender': return 0.08; // 8% return to education
                case 'experience_training': return 0.05; // 5% return to experience
                case 'age_technology': return -0.02; // Technology adoption declines with age
                case 'income_policy': return 0.10; // Income effect of policy
                default: return 0.05;
            }
        }
        
        function getPowerLevel(power) {
            switch(power) {
                case 'low': return 1.5; // Low power
                case 'medium': return 2.5; // Medium power
                case 'high': return 4.0; // High power
                default: return 2.0;
            }
        }
        
        function displayInteractionResults(results, context, type) {
            document.getElementById('interactionCoeff').textContent = results.interactionCoeff.toFixed(4);
            document.getElementById('interactionTStat').textContent = results.interactionTStat.toFixed(3);
            document.getElementById('group0Effect').textContent = results.group0Effect.toFixed(4);
            document.getElementById('group1Effect').textContent = results.group1Effect.toFixed(4);
            
            // Create interaction visualization
            const canvas = document.getElementById('interactionCanvas');
            canvas.innerHTML = '';
            
            // Draw two lines representing the groups
            for (let group = 0; group <= 1; group++) {
                const effect = group === 0 ? results.group0Effect : results.group1Effect;
                const color = group === 0 ? 'var(--group-a)' : 'var(--group-b)';
                
                // Draw line for this group
                const line = document.createElement('div');
                const slope = effect * 100; // Convert to percentage for visualization
                line.style.cssText = `
                    position: absolute;
                    left: 10%;
                    top: ${60 - slope}%;
                    width: 80%;
                    height: 2px;
                    background: ${color};
                    transform: rotate(${Math.atan(slope/100) * 180/Math.PI}deg);
                    transform-origin: left center;
                `;
                canvas.appendChild(line);
                
                // Add group label
                const label = document.createElement('div');
                label.style.cssText = `
                    position: absolute;
                    left: ${group === 0 ? '5%' : '85%'};
                    top: ${55 - slope}%;
                    font-size: var(--text-xs);
                    color: ${color};
                    font-weight: 600;
                `;
                label.textContent = `Group ${group}`;
                canvas.appendChild(label);
            }
            
            // Analysis
            const contextNames = {
                education_gender: 'education returns by gender',
                experience_training: 'experience returns with training',
                age_technology: 'age and technology adoption',
                income_policy: 'income effects of policy'
            };
            
            const typeDescriptions = {
                enhancing: 'The effect is stronger in Group 1 (positive interaction)',
                diminishing: 'The effect is weaker in Group 1 (negative interaction)',
                neutral: 'No meaningful difference between groups',
                reversing: 'The effect reverses direction between groups'
            };
            
            const analysis = `
                Interaction analysis for ${contextNames[context]}:
                
                Main effect (Group 0): ${(results.group0Effect * 100).toFixed(2)}% per unit
                Group 1 effect: ${(results.group1Effect * 100).toFixed(2)}% per unit
                Interaction coefficient: ${results.interactionCoeff.toFixed(4)} (t = ${results.interactionTStat.toFixed(3)})
                
                Interpretation: ${typeDescriptions[type]}
                
                ${Math.abs(results.interactionTStat) > 1.96 ? 
                'Statistically significant interaction detected - the relationship truly differs between groups.' :
                'Interaction is not statistically significant - no evidence of differential effects.'}
                
                Policy implication: ${getInteractionPolicyImplication(context, type, Math.abs(results.interactionTStat) > 1.96)}
                
                Professional note: Interactions require larger samples for adequate power. Always test for interactions when theory suggests group differences.
            `;
            
            document.getElementById('interactionAnalysis').textContent = analysis;
            document.getElementById('interactionResults').style.display = 'block';
        }
        
        function getInteractionPolicyImplication(context, type, significant) {
            if (!significant) return "No evidence of differential treatment effects across groups.";
            
            switch(context) {
                case 'education_gender':
                    return type === 'enhancing' ? "Education investment may be more beneficial for one gender." :
                           "Education returns may be constrained for one gender - investigate barriers.";
                case 'experience_training':
                    return type === 'enhancing' ? "Training programs work better for experienced workers." :
                           "Training may be more needed for inexperienced workers.";
                case 'age_technology':
                    return "Technology adoption programs should be age-targeted for maximum effectiveness.";
                case 'income_policy':
                    return type === 'enhancing' ? "Policy effects increase with income - may worsen inequality." :
                           "Policy effects decrease with income - may reduce inequality.";
                default:
                    return "Heterogeneous treatment effects detected - consider targeted interventions.";
            }
        }
        
        // ========================================
        // GROUP DIFFERENCE TESTING ENGINE
        // ========================================
        
        function conductGroupTests() {
            const question = document.getElementById('researchQuestion').value;
            const testType = document.getElementById('testType').value;
            const effectSize = document.getElementById('trueEffectSize').value;
            const alpha = parseFloat(document.getElementById('significanceLevel').value);
            
            // Simulate hypothesis testing
            const results = simulateHypothesisTests(question, testType, effectSize, alpha);
            
            // Display results
            displayTestingResults(results, testType, alpha);
        }
        
        function simulateHypothesisTests(question, testType, effectSize, alpha) {
            // Generate test statistic based on effect size
            const trueEffect = getEffectSize(effectSize);
            const standardError = 0.1; // Standardized
            const testStat = trueEffect / standardError;
            
            // Get critical value based on test type
            const criticalValue = getCriticalValue(testType, alpha);
            
            // Calculate p-value
            let pValue;
            if (testType === 'multiple_groups') {
                // F-test
                const fStat = Math.pow(testStat, 2); 
                pValue = 1 - fCDF(fStat, 3, 496); // 3 groups, df = n-k-1
            } else {
                // t-test
                pValue = 2 * (1 - normalCDF(Math.abs(testStat)));
            }
            
            const reject = pValue < alpha;
            
            return {
                testStatistic: testType === 'multiple_groups' ? Math.pow(testStat, 2) : testStat,
                criticalValue: criticalValue,
                pValue: pValue,
                reject: reject,
                effectSize: trueEffect
            };
        }
        
        function getEffectSize(effectSize) {
            switch(effectSize) {
                case 'none': return 0;
                case 'small': return 0.2;
                case 'medium': return 0.5;
                case 'large': return 0.8;
                default: return 0;
            }
        }
        
        function getCriticalValue(testType, alpha) {
            if (testType === 'multiple_groups') {
                // F critical value (approximate)
                return alpha === 0.05 ? 2.60 : alpha === 0.01 ? 3.78 : 2.08;
            } else {
                // t critical value (approximate for large df)
                return alpha === 0.05 ? 1.96 : alpha === 0.01 ? 2.58 : 1.64;
            }
        }
        
        function displayTestingResults(results, testType, alpha) {
            document.getElementById('testStatistic').textContent = results.testStatistic.toFixed(3);
            document.getElementById('criticalValue').textContent = results.criticalValue.toFixed(3);
            document.getElementById('testPValue').textContent = results.pValue.toFixed(4);
            
            // Animate progress bar
            const progressBar = document.getElementById('testingProgress');
            progressBar.style.width = '100%';
            
            // Decision assessment
            const decisionElement = document.getElementById('testDecision');
            const descriptionElement = document.getElementById('decisionDescription');
            
            if (results.reject) {
                decisionElement.className = 'group-indicator group-significant';
                decisionElement.innerHTML = '<span>Reject H‚ÇÄ</span>';
                descriptionElement.textContent = 'Significant difference';
            } else {
                decisionElement.className = 'group-indicator group-insignificant';
                decisionElement.innerHTML = '<span>Fail to Reject</span>';
                descriptionElement.textContent = 'No significant difference';
            }
            
            // Analysis
            const testNames = {
                single_group: 'Single group t-test',
                multiple_groups: 'Joint F-test for multiple groups',
                equality_test: 'Test of equal effects',
                interaction_test: 'Interaction significance test'
            };
            
            const analysis = `
                ${testNames[testType]} results:
                
                Test statistic: ${results.testStatistic.toFixed(3)}
                Critical value (Œ± = ${alpha}): ${results.criticalValue.toFixed(3)}
                p-value: ${results.pValue.toFixed(4)}
                
                Decision: ${results.reject ? 'Reject' : 'Fail to reject'} the null hypothesis
                
                ${results.reject ? 
                `Statistical evidence of group differences. The observed effect (${results.effectSize.toFixed(2)} standard deviations) is unlikely due to chance.` :
                'No statistical evidence of group differences. Observed differences may be due to sampling variation.'}
                
                Power analysis: ${getPowerAnalysis(results.effectSize, results.reject)}
                
                Professional interpretation: ${getTestingInterpretation(results.reject, results.effectSize, alpha)}
            `;
            
            document.getElementById('testingAnalysis').textContent = analysis;
            document.getElementById('testingResults').style.display = 'block';
        }
        
        function getPowerAnalysis(effectSize, detected) {
            if (effectSize === 0) {
                return detected ? "Type I error occurred (false positive)." : "Correct null hypothesis retention.";
            } else {
                return detected ? "Sufficient power to detect the true effect." : "Insufficient power - may be Type II error.";
            }
        }
        
        function getTestingInterpretation(reject, effectSize, alpha) {
            if (reject && effectSize > 0) {
                return "Evidence supports policy relevance - proceed with implementation considerations.";
            } else if (reject && effectSize === 0) {
                return `False positive (Type I error) occurred - happens ${(alpha * 100).toFixed(0)}% of the time.`;
            } else if (!reject && effectSize > 0) {
                return "True effect exists but not detected - consider increasing sample size or reducing noise.";
            } else {
                return "No effect present - null hypothesis is true.";
            }
        }
        
        // ========================================
        // LINEAR PROBABILITY MODEL CALCULATOR
        // ========================================
        
        function estimateLPM() {
            const outcome = document.getElementById('binaryOutcome').value;
            const predictor = document.getElementById('keyPredictor').value;
            const specification = document.getElementById('lpmSpecification').value;
            const characteristics = document.getElementById('sampleCharacteristics').value;
            
            // Simulate LPM estimation
            const results = simulateLPM(outcome, predictor, specification, characteristics);
            
            // Display results
            displayLPMResults(results, outcome, predictor);
        }
        
        function simulateLPM(outcome, predictor, specification, characteristics) {
            // Generate marginal effect based on outcome type
            const marginalEffect = getLPMMarginalEffect(outcome);
            
            // Add specification adjustments
            let adjustedEffect = marginalEffect;
            if (specification === 'robust') {
                adjustedEffect *= 0.95; // Slight adjustment for robustness
            }
            
            // Calculate standard error and significance
            const standardError = Math.abs(adjustedEffect) * 0.3;
            const tStatistic = adjustedEffect / standardError;
            
            // Calculate violation rate (predictions outside [0,1])
            const violationRate = Math.random() * 0.15; // 0-15% violations
            
            // Model quality assessment
            const quality = assessLPMQuality(violationRate, Math.abs(tStatistic));
            
            return {
                marginalEffect: adjustedEffect,
                tStatistic: tStatistic,
                violationRate: violationRate,
                quality: quality
            };
        }
        
        function getLPMMarginalEffect(outcome) {
            switch(outcome) {
                case 'employment': return 0.12; // 12 percentage point effect
                case 'program_participation': return 0.08; // 8 percentage point effect
                case 'college_attendance': return 0.15; // 15 percentage point effect
                case 'policy_support': return 0.06; // 6 percentage point effect
                default: return 0.10;
            }
        }
        
        function assessLPMQuality(violationRate, tStatAbs) {
            if (violationRate < 0.05 && tStatAbs > 2.0) return 'excellent';
            if (violationRate < 0.10 && tStatAbs > 1.5) return 'good';
            return 'problematic';
        }
        
        function displayLPMResults(results, outcome, predictor) {
            document.getElementById('marginalEffect').textContent = (results.marginalEffect * 100).toFixed(2) + ' pp';
            document.getElementById('lpmTStatistic').textContent = results.tStatistic.toFixed(3);
            document.getElementById('violationRate').textContent = (results.violationRate * 100).toFixed(1) + '%';
            
            // Quality assessment
            const qualityElement = document.getElementById('lpmQuality');
            const assessmentElement = document.getElementById('lpmAssessment');
            
            switch(results.quality) {
                case 'excellent':
                    qualityElement.className = 'group-indicator group-significant';
                    qualityElement.innerHTML = '<span>Excellent</span>';
                    assessmentElement.textContent = 'LPM appropriate';
                    break;
                case 'good':
                    qualityElement.className = 'group-indicator group-marginal';
                    qualityElement.innerHTML = '<span>Good</span>';
                    qualityElement.innerHTML = '<span>Acceptable</span>';
                    assessmentElement.textContent = 'Minor issues';
                    break;
                default:
                    qualityElement.className = 'group-indicator group-insignificant';
                    qualityElement.innerHTML = '<span>Problematic</span>';
                    assessmentElement.textContent = 'Consider alternatives';
            }
            
            // Create LPM visualization
            const canvas = document.getElementById('lpmCanvas');
            canvas.innerHTML = '';
            
            // Draw probability line
            const numPoints = 20;
            for (let i = 0; i < numPoints; i++) {
                const x = i / (numPoints - 1);
                const baseProb = 0.3; // Base probability
                const predictedProb = baseProb + results.marginalEffect * x;
                
                // Ensure within bounds for visualization
                const clampedProb = Math.max(0.05, Math.min(0.95, predictedProb));
                
                const point = document.createElement('div');
                point.style.cssText = `
                    position: absolute;
                    left: ${x * 85 + 5}%;
                    top: ${(1 - clampedProb) * 80 + 10}%;
                    width: 4px;
                    height: 4px;
                    background: var(--group-a);
                    border-radius: 50%;
                `;
                canvas.appendChild(point);
                
                // Highlight violations (if any)
                if (predictedProb < 0 || predictedProb > 1) {
                    point.style.background = 'var(--error-reject)';
                }
            }
            
            // Draw bounds
            ['0%', '100%'].forEach((label, i) => {
                const line = document.createElement('div');
                line.style.cssText = `
                    position: absolute;
                    left: 5%;
                    top: ${i * 80 + 10}%;
                    width: 85%;
                    height: 1px;
                    background: var(--gray-400);
                    opacity: 0.5;
                `;
                canvas.appendChild(line);
                
                const labelDiv = document.createElement('div');
                labelDiv.style.cssText = `
                    position: absolute;
                    right: 2%;
                    top: ${i * 80 + 5}%;
                    font-size: var(--text-xs);
                    color: var(--gray-500);
                `;
                labelDiv.textContent = i === 0 ? '1.0' : '0.0';
                canvas.appendChild(labelDiv);
            });
            
            // Analysis
            const outcomeNames = {
                employment: 'employment probability',
                program_participation: 'program participation',
                college_attendance: 'college attendance probability',
                policy_support: 'policy support probability'
            };
            
            const analysis = `
                Linear Probability Model for ${outcomeNames[outcome]}:
                
                Marginal effect: ${(results.marginalEffect * 100).toFixed(2)} percentage points
                Statistical significance: t = ${results.tStatistic.toFixed(3)} ${Math.abs(results.tStatistic) > 1.96 ? '(significant)' : '(not significant)'}
                Prediction violations: ${(results.violationRate * 100).toFixed(1)}% of predictions outside [0,1]
                
                ${results.quality === 'excellent' ? 
                'LPM performs well with minimal violations and significant effects.' :
                results.quality === 'good' ? 
                'LPM is acceptable but consider robustness checks.' :
                'LPM shows problems - consider logit/probit models or restrict sample range.'}
                
                Policy interpretation: ${getLPMPolicyInterpretation(outcome, results.marginalEffect, Math.abs(results.tStatistic) > 1.96)}
                
                Technical note: ${results.violationRate > 0.1 ? 
                'High violation rate suggests LPM may be inappropriate - consider logistic regression.' :
                'Low violation rate supports LPM validity. Always use robust standard errors.'}
            `;
            
            document.getElementById('lpmAnalysis').textContent = analysis;
            document.getElementById('lpmResults').style.display = 'block';
        }
        
        function getLPMPolicyInterpretation(outcome, effect, significant) {
            if (!significant) return "No significant effect on outcome probability.";
            
            const effectSize = Math.abs(effect) * 100;
            const direction = effect > 0 ? 'increases' : 'decreases';
            
            switch(outcome) {
                case 'employment':
                    return `Policy ${direction} employment probability by ${effectSize.toFixed(1)} percentage points - ${effectSize > 10 ? 'large' : effectSize > 5 ? 'moderate' : 'small'} effect.`;
                case 'program_participation':
                    return `Intervention ${direction} participation by ${effectSize.toFixed(1)} pp - consider cost-effectiveness.`;
                case 'college_attendance':
                    return `Factor ${direction} college enrollment by ${effectSize.toFixed(1)} pp - important for education policy.`;
                case 'policy_support':
                    return `Variable ${direction} policy support by ${effectSize.toFixed(1)} pp - relevant for political feasibility.`;
                default:
                    return `Significant ${effectSize.toFixed(1)} percentage point effect detected.`;
            }
        }
        
        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        
        function normalCDF(z) {
            // Standard normal CDF approximation
            return 0.5 * (1 + erf(z / Math.sqrt(2)));
        }
        
        function erf(x) {
            // Error function approximation
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return sign * y;
        }
        
        function fCDF(f, df1, df2) {
            // Simplified F-distribution CDF (approximation)
            if (f <= 0) return 0;
            
            // Convert to beta distribution (approximate)
            const x = df1 * f / (df1 * f + df2);
            return betaCDF(x, df1/2, df2/2);
        }
        
        function betaCDF(x, a, b) {
            // Simplified beta CDF (very basic approximation)
            if (x <= 0) return 0;
            if (x >= 1) return 1;
            
            // Use normal approximation for large parameters
            if (a > 5 && b > 5) {
                const mean = a / (a + b);
                const variance = (a * b) / ((a + b) * (a + b) * (a + b + 1));
                const z = (x - mean) / Math.sqrt(variance);
                return normalCDF(z);
            }
            
            // Simple approximation for small parameters
            return Math.pow(x, a) * Math.pow(1-x, b) / (a * b / (a + b));
        }
        
        // ========================================
        // QUIZ FUNCTIONS
        // ========================================
        
        function selectQuizAnswer(questionId, answer) {
            const correctAnswers = {
                '7-1': 'B',
                '7-2': 'B', 
                '7-3': 'B'
            };
            
            const explanations = {
                '7-1': {
                    correct: 'Correct! With k categories, use k-1 dummy variables to avoid the dummy variable trap. One category serves as the base group (omitted category).',
                    incorrect: 'Incorrect. You need k-1 dummies for k categories. Including all k creates perfect multicollinearity because the dummies always sum to 1.'
                },
                '7-2': {
                    correct: 'Correct! Œ≤‚ÇÉ measures how the effect of x differs between the two groups. It shows whether the slope of the x-y relationship is different for D=1 vs D=0.',
                    incorrect: 'Incorrect. Œ≤‚ÇÉ is the interaction coefficient - it measures how the marginal effect of x varies between the two groups (D=0 vs D=1).'
                },
                '7-3': {
                    correct: 'Correct! In LPM, coefficients represent changes in probability. A coefficient of 0.15 means the probability increases by 15 percentage points.',
                    incorrect: 'Incorrect. In Linear Probability Models, coefficients are marginal effects on probability measured in percentage points, not percentages or other units.'
                }
            };
            
            const isCorrect = answer === correctAnswers[questionId];
            const feedbackElement = document.getElementById(`feedback${questionId}`);
            
            // Update option styling
            const options = document.querySelectorAll(`input[name="q${questionId}"]`);
            options.forEach(option => {
                const label = option.closest('.quiz-option');
                label.classList.remove('correct', 'incorrect');
                if (option.value === correctAnswers[questionId]) {
                    label.classList.add('correct');
                } else if (option.checked) {
                    label.classList.add('incorrect');
                }
            });
            
            // Show feedback
            feedbackElement.textContent = isCorrect ? 
                explanations[questionId].correct : 
                explanations[questionId].incorrect;
            feedbackElement.className = `quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackElement.style.display = 'block';
        }
        
        // ========================================
        // QUESTION GENERATION
        // ========================================
        
        function generateQuestions(type) {
            const questionBank = {
                dummy_variables: [
                    {
                        question: "What happens if you include dummy variables for all categories?",
                        options: ["A) Perfect model fit", "B) Dummy variable trap", "C) Improved R¬≤", "D) More accurate estimates"],
                        correct: "B",
                        explanation: "Including all categories creates perfect multicollinearity (dummy variable trap) because the dummies sum to 1."
                    },
                    {
                        question: "In wage = Œ≤‚ÇÄ + Œ≤‚ÇÅeduc + Œ≤‚ÇÇfemale + u, what does Œ≤‚ÇÇ represent?",
                        options: ["A) Female wage level", "B) Gender wage gap", "C) Male wage premium", "D) Education effect for females"],
                        correct: "B",
                        explanation: "Œ≤‚ÇÇ shows the wage difference between females and males, controlling for education (the gender wage gap)."
                    },
                    {
                        question: "Which category should typically be chosen as the base group?",
                        options: ["A) Largest category", "B) Most interesting", "C) Natural reference point", "D) Alphabetically first"],
                        correct: "C",
                        explanation: "Choose a natural reference point that makes economic sense for comparisons (like 'no treatment' or 'high school')."
                    }
                ],
                interactions: [
                    {
                        question: "If Œ≤‚ÇÉ > 0 in y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + Œ≤‚ÇÉ(x√óD), the effect of x is:",
                        options: ["A) Same for both groups", "B) Larger when D=1", "C) Larger when D=0", "D) Always positive"],
                        correct: "B",
                        explanation: "Positive interaction (Œ≤‚ÇÉ > 0) means the effect of x is stronger in the D=1 group (effect = Œ≤‚ÇÅ + Œ≤‚ÇÉ)."
                    },
                    {
                        question: "Why are interaction terms important in policy evaluation?",
                        options: ["A) Improve R¬≤", "B) Heterogeneous treatment effects", "C) Reduce standard errors", "D) Avoid bias"],
                        correct: "B",
                        explanation: "Interactions reveal heterogeneous treatment effects - whether policies work differently for different groups."
                    },
                    {
                        question: "When testing interaction significance, what is the null hypothesis?",
                        options: ["A) Œ≤‚ÇÅ = 0", "B) Œ≤‚ÇÇ = 0", "C) Œ≤‚ÇÉ = 0", "D) Œ≤‚ÇÅ = Œ≤‚ÇÇ"],
                        correct: "C",
                        explanation: "H‚ÇÄ: Œ≤‚ÇÉ = 0 tests whether the interaction effect is zero (no differential effect between groups)."
                    }
                ],
                group_testing: [
                    {
                        question: "For testing equality of 4 group means, what test should you use?",
                        options: ["A) Multiple t-tests", "B) Joint F-test", "C) Chi-square test", "D) Z-test"],
                        correct: "B",
                        explanation: "Joint F-test avoids multiple testing problems and tests H‚ÇÄ: all group coefficients equal zero simultaneously."
                    },
                    {
                        question: "What's the problem with multiple pairwise t-tests?",
                        options: ["A) Low power", "B) Type I error inflation", "C) Biased estimates", "D) Wrong degrees of freedom"],
                        correct: "B",
                        explanation: "Multiple t-tests inflate Type I error rate. With 4 groups (6 comparisons), chance of false positive exceeds 26%."
                    },
                    {
                        question: "In program evaluation, what does failing to reject H‚ÇÄ mean?",
                        options: ["A) Program doesn't work", "B) No evidence of effect", "C) Program is harmful", "D) Need larger sample"],
                        correct: "B",
                        explanation: "Failing to reject means no statistical evidence of effect - could be no true effect OR insufficient power to detect it."
                    }
                ],
                linear_probability: [
                    {
                        question: "What's the main limitation of Linear Probability Models?",
                        options: ["A) Heteroskedasticity", "B) Predictions outside [0,1]", "C) Non-linear effects", "D) All of the above"],
                        correct: "D",
                        explanation: "LPM suffers from heteroskedasticity, can predict impossible probabilities, and assumes linear probability effects."
                    },
                    {
                        question: "How should you calculate standard errors in LPM?",
                        options: ["A) OLS standard errors", "B) Robust standard errors", "C) Bootstrap", "D) Any method works"],
                        correct: "B",
                        explanation: "LPM has heteroskedasticity by construction, so robust (White) standard errors are essential for valid inference."
                    },
                    {
                        question: "When might LPM be preferred over logit/probit?",
                        options: ["A) Small samples", "B) Easy interpretation", "C) Better fit", "D) No heteroskedasticity"],
                        correct: "B",
                        explanation: "LPM coefficients are marginal effects (percentage points) - much easier to interpret than logit/probit coefficients."
                    }
                ]
            };
            
            const questions = questionBank[type];
            if (!questions) return;
            
            // Select 3 random questions
            const selectedQuestions = [];
            const usedIndices = new Set();
            
            while (selectedQuestions.length < 3 && selectedQuestions.length < questions.length) {
                const randomIndex = Math.floor(Math.random() * questions.length);
                if (!usedIndices.has(randomIndex)) {
                    selectedQuestions.push(questions[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }
            
            displayGeneratedQuestions(selectedQuestions, type);
        }
        
        function displayGeneratedQuestions(questions, type) {
            const container = document.getElementById('generatedQuestionsList');
            const typeLabels = {
                dummy_variables: 'üé≠ Dummy Variables',
                interactions: 'üîó Interactions',
                group_testing: 'üß™ Group Testing',
                linear_probability: 'üìä Linear Probability'
            };
            
            let html = `<h4 style="color: var(--primary-policy); margin-bottom: var(--space-lg);">
                ${typeLabels[type]} Practice Questions
            </h4>`;
            
            questions.forEach((q, index) => {
                generatedQuestionCount++;
                const questionId = `gen-${generatedQuestionCount}`;
                
                html += `
                    <div class="quiz-question" style="border: 2px solid var(--accent-analysis); border-radius: 12px; padding: var(--space-lg);">
                        <p><strong>Question ${index + 1}:</strong> ${q.question}</p>
                        <div class="quiz-options">
                            ${q.options.map((option, optIndex) => `
                                <label class="quiz-option" onclick="selectGeneratedQuizAnswer('${questionId}', '${String.fromCharCode(65 + optIndex)}', '${q.correct}', '${q.explanation.replace(/'/g, "\\'")}')">
                                    <input type="radio" name="q${questionId}" value="${String.fromCharCode(65 + optIndex)}">
                                    ${option}
                                </label>
                            `).join('')}
                        </div>
                        <div id="feedback${questionId}" class="quiz-feedback" style="display: none;"></div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('generatedQuestions').style.display = 'block';
            
            // Scroll to generated questions
            document.getElementById('generatedQuestions').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
        
        function selectGeneratedQuizAnswer(questionId, answer, correct, explanation) {
            const isCorrect = answer === correct;
            const feedbackElement = document.getElementById(`feedback${questionId}`);
            
            // Update option styling
            const options = document.querySelectorAll(`input[name="q${questionId}"]`);
            options.forEach(option => {
                const label = option.closest('.quiz-option');
                label.classList.remove('correct', 'incorrect');
                if (option.value === correct) {
                    label.classList.add('correct');
                } else if (option.checked) {
                    label.classList.add('incorrect');
                }
            });
            
            // Show feedback
            feedbackElement.textContent = explanation;
            feedbackElement.className = `quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedbackElement.style.display = 'block';
        }
        
        function clearGeneratedQuestions() {
            document.getElementById('generatedQuestions').style.display = 'none';
            document.getElementById('generatedQuestionsList').innerHTML = '';
        }
        
        // ========================================
        // AI CHAT FUNCTIONS (Chapter 7 Specific)
        // ========================================
        
        function toggleAIChat() {
            const panel = document.getElementById('aiChatPanel');
            const icon = document.getElementById('aiChatIcon');
            
            if (isAIChatOpen) {
                panel.classList.remove('show');
                icon.textContent = 'üé≠';
                isAIChatOpen = false;
            } else {
                panel.classList.add('show');
                icon.textContent = '‚úñÔ∏è';
                isAIChatOpen = true;
                
                // Focus input
                setTimeout(() => {
                    const input = document.getElementById('aiInput');
                    if (input) input.focus();
                }, 100);
            }
        }
        
        function sendAIMessage() {
            const input = document.getElementById('aiInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addAIMessage('user', message);
            
            // Clear input
            input.value = '';
            
            // Generate AI response
            setTimeout(() => {
                const response = getChapter7AIResponse(message);
                addAIMessage('claude', response);
            }, 800);
        }
        
        function addAIMessage(sender, message) {
            const messagesContainer = document.getElementById('aiChatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${sender}`;
            
            if (sender === 'claude') {
                messageDiv.innerHTML = `<strong>üé≠ Claude:</strong> ${message}`;
            } else {
                messageDiv.textContent = message;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function getChapter7AIResponse(userMessage) {
            const message = userMessage.toLowerCase();
            
            if (message.includes('dummy') || message.includes('categorical') || message.includes('qualitative')) {
                return "Dummy variables code categorical information as 0/1. Key rule: use k-1 dummies for k categories to avoid the dummy variable trap. Coefficients show differences relative to the omitted base group. Choose a natural reference category that makes economic sense!";
            }
            
            if (message.includes('interaction') || message.includes('heterogeneous') || message.includes('differential')) {
                return "Interaction terms reveal heterogeneous effects! In y = Œ≤‚ÇÄ + Œ≤‚ÇÅx + Œ≤‚ÇÇD + Œ≤‚ÇÉ(x√óD), Œ≤‚ÇÉ shows how the effect of x differs between groups. Positive Œ≤‚ÇÉ means x has stronger effects in the D=1 group. Essential for understanding 'treatment effect heterogeneity'!";
            }
            
            if (message.includes('base group') || message.includes('reference') || message.includes('omitted')) {
                return "Base group choice affects interpretation but not model fit. Choose the most natural reference: 'no treatment' for programs, 'high school' for education, largest group for stability. All other coefficients show differences relative to this base.";
            }
            
            if (message.includes('test') || message.includes('hypothesis') || message.includes('significance')) {
                return "Group testing framework: Single group (t-test), multiple groups (joint F-test), interaction significance (t-test on interaction). Avoid multiple t-tests - they inflate Type I error! Joint F-test: H‚ÇÄ = all group coefficients equal zero.";
            }
            
            if (message.includes('linear probability') || message.includes('lpm') || message.includes('binary')) {
                return "Linear Probability Model: OLS with binary dependent variable. Coefficients = marginal effects on probability (percentage points). Limitations: heteroskedasticity (use robust SE), predictions outside [0,1]. Advantage: easy interpretation vs. logit/probit!";
            }
            
            if (message.includes('trap') || message.includes('multicollinearity') || message.includes('perfect')) {
                return "Dummy variable trap occurs when including all k category dummies - creates perfect multicollinearity because they sum to 1. Computer can't estimate the model. Solution: always omit one category as the base group. Choice of base affects coefficients but not predictions!";
            }
            
            if (message.includes('policy') || message.includes('treatment') || message.includes('program')) {
                return "Policy evaluation with dummies: Treatment dummy shows average treatment effect. Interactions reveal heterogeneous effects across groups. Testing determines statistical significance. Essential for program assessment and understanding 'what works for whom'!";
            }
            
            if (message.includes('calculator') || message.includes('tool') || message.includes('simulation')) {
                return "Chapter 7 tools demonstrate qualitative analysis! Try dummy effects for group comparisons, multiple categories for complex classifications, interactions for heterogeneous effects, group testing for significance, and LPM for binary outcomes.";
            }
            
            if (message.includes('help') || message.includes('confused') || message.includes('overview')) {
                return "I can help with qualitative variable analysis! Topics: dummy variable basics, multiple categories, interaction effects, group difference testing, and linear probability models. What specific aspect interests you?";
            }
            
            return "Chapter 7 covers qualitative information in regression - dummy variables, interactions, and group analysis. I can explain dummy variable setup, interaction interpretation, group testing, and linear probability models. What would you like to explore?";
        }
        
        // Close AI chat when clicking outside
        document.addEventListener('click', function(event) {
            const widget = document.getElementById('aiChatWidget');
            if (isAIChatOpen && !widget.contains(event.target)) {
                toggleAIChat();
            }
        });
        
        // ========================================
        // INITIALIZATION AND UTILITY
        // ========================================
        
        function showComingSoon() {
            alert('Chapter 8 is coming soon! üöÄ\n\nYou\'ve mastered qualitative information analysis (Chapter 7). Future chapters will cover heteroskedasticity, specification testing, instrumental variables, and panel data methods.');
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Chapter 7 loaded successfully - Qualitative Variables ready!');
            
            // Set up fade-in animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0) scale(1)';
                    }
                });
            }, observerOptions);
            
            // Observe all animated elements
            document.querySelectorAll('.fade-in, .slide-up, .policy-animation').forEach(el => {
                observer.observe(el);
            });
            
            console.log('Chapter 7 Qualitative Variables - Ready for categorical analysis!');
        });
        
    </script>

</body>
</html>
